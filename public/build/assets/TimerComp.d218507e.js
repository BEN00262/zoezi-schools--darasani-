import{r,R as E}from"./vendor.5c57f7a1.js";import{j as M,M as O}from"./App.453ee391.js";import{a as v,j as t,F as Q}from"./index.6ae16ec9.js";import{c as B}from"./millisecondsToTime.6095074a.js";const D=({option:e,_id:s,isCorrect:n,isMarked:p,index:m,position:o,setSuggestedAnswer:d,wasSelected:h})=>t("div",{children:t("p",{children:v("label",{children:[t("input",{type:"checkbox",className:"filled-in",disabled:p,checked:h||!1,onChange:b=>{d({option:e,isCorrect:n,_id:s})},name:`options_${o}`}),t("span",{className:p&&n?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})})},m),F=({option:e,_id:s,isCorrect:n,isMarked:p,index:m,position:o,setSuggestedAnswer:d,wasSelected:h})=>t("div",{children:t("p",{children:v("label",{children:[t("input",{disabled:p,onChange:b=>{d({option:e,isCorrect:n,_id:s})},required:!0,checked:h||!1,className:"with-gap",name:`options_${o}`,type:"radio"}),t("span",{className:p&&n?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})})},m),q=({question:e,position:s,isMarked:n,setAttempted:p,setCorrectAnswersCount:m,savedQuestion:o,AddPageStudentPaperContent:d})=>{const{currentPage:h,attemptTree:b}=r.exports.useContext(M),[i,c]=r.exports.useState([]),[y,_]=r.exports.useState(!1),f=r.exports.useMemo(()=>{var l,u;return((u=(l=e==null?void 0:e.options_next)==null?void 0:l.filter(x=>x.isCorrect))==null?void 0:u.length)||0},[e]),I=f>1||!1,A=l=>!!i.find(u=>u._id===l);r.exports.useEffect(()=>{let l=document.querySelectorAll(".question-comp img");O.Materialbox.init(l);let u=b.pages[h].find(a=>a.content.question===e._id);if(!u)return;let x=u.content,w=(e.options_next||[]).filter((a,g)=>x.attempted_options.findIndex(C=>C.optionID===a._id||C.optionIndex===g)>-1);_(w.length>0?w.every(a=>a.isCorrect):!1),c([...i,...w])},[]),r.exports.useEffect(()=>{i.length>0&&d(e._id,{questionType:"normal",content:{status:i.length>0?i.every(l=>l.isCorrect):!1,question:e._id,attempted_options:i.map(l=>({optionID:l._id,optionIndex:(e.options_next||[]).findIndex(u=>u._id===l._id)}))}})},[i]),r.exports.useEffect(()=>{if(n&&f===i.length){let l=i.length>0?i.every(u=>u.isCorrect):!1;_(l),m(l?1:0)}},[n]);const S=l=>{if(i.length||p(1),I){const u=i.findIndex(x=>x.option===l.option);if(u>-1){let x=[...i];x.splice(u),c(x),x.length||p(-1);return}c([...i,l]);return}c([l])},N=(()=>{let l=I?D:F;return({position:u,index:x,_id:w,option:a,isCorrect:g,wasSelected:C})=>t(l,{_id:w,setSuggestedAnswer:S,position:u,option:a,index:x,isCorrect:g,isMarked:n,wasSelected:C},x)})();return v("div",{children:[t("span",{dangerouslySetInnerHTML:{__html:`
                    <div style="display:flex;flex-direction:row;">
                        ${n?y?'<span style="color:green;">&#10004;</span>':'<span style="color:red;">&#10008;</span>':""} 
                        <p style="margin-right:5px;">${s+1}.  </p><strong class="question-comp">${e.question}</strong>
                    </div>
                `}}),t("div",{style:{marginTop:"10px",marginLeft:"17px",marginBottom:"10px"},children:e.options_next&&e.options_next.map(({option:l,isCorrect:u,_id:x},w)=>N({position:s,_id:x,option:l,index:w,isCorrect:u,wasSelected:A(x)}))}),t("div",{style:{marginLeft:"17px",marginBottom:"10px"},hidden:!n,children:t("span",{dangerouslySetInnerHTML:{__html:`
                        <blockquote class="red lighten-5">
                            <span>
                            ${e.additionalInfo}
                            </span>
                        </blockquote>
                    `}})})]})},H=({option:e,wasSelected:s,isCorrect:n,_id:p,isMarked:m,index:o,position:d,setAnswers:h,isMultiAnswersQuestion:b})=>t("div",{children:t("p",{children:v("label",{children:[t("input",{type:"checkbox",checked:s,className:"filled-in",disabled:m,onChange:i=>{h({option:e,isCorrect:n,_id:p})},required:!0,name:`sub_option_answer_${d}`}),t("span",{className:m&&n?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})})},o),P=({option:e,wasSelected:s,isCorrect:n,_id:p,isMarked:m,keyValue:o,position:d,setAnswers:h,isMultiAnswersQuestion:b})=>t("p",{children:v("label",{children:[t("input",{disabled:m,checked:s,required:!0,onChange:i=>{h({option:e,isCorrect:n,_id:p})},className:"with-gap",type:"radio",name:`sub_option_answer_${d}`}),t("span",{className:m&&n?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})},o),V=({children:e,index:s,isMarked:n,isCorrect:p})=>v("div",{style:{marginLeft:"15px",marginTop:"5px",marginBottom:"5px",display:"flex",flexDirection:"row"},children:[n?p?t("span",{style:{color:"green"},children:"\u2714"}):t("span",{style:{color:"red"},children:"\u2718"}):null,s+1,".",t("div",{children:e})]}),z=({children:e,index:s})=>t("div",{style:{marginLeft:"15px",marginTop:"5px",marginBottom:"5px"},children:e}),J=({question:e,index:s,AddInternalPaperContents:n,setAttempted:p,setCorrectAnswersCount:m,savedState:o,parentId:d})=>{const{attemptTree:h,currentPage:b,isMarked:i}=r.exports.useContext(M),[c,y]=r.exports.useState([]),[_,f]=r.exports.useState(!1),[I,A]=r.exports.useState(0);r.exports.useEffect(()=>{let a=h.pages[b].find($=>$.content.question===d);if(!a)return;let C=a.content.children.find($=>$.question===e._id);if(!C)return;let T=(e.options||[]).filter(($,R)=>C?C.attempted_options.findIndex(L=>L.optionID===$._id||L.optionIndex===R)>-1:!1);f(C.status),y([...c,...T])},[]),r.exports.useEffect(()=>{if(i&&c.length>0){let a=c.every(g=>g.isCorrect);f(a)}},[i,c]),r.exports.useEffect(()=>{I>0&&n({status:c.length?c.every(a=>a.isCorrect):!1,question:e._id,attempted_options:c.map(a=>({optionID:a._id,optionIndex:e.options.findIndex(g=>g._id===a._id)}))})},[I]);const S=r.exports.useMemo(()=>{var a,g;return((g=(a=e==null?void 0:e.options)==null?void 0:a.filter(C=>C.isCorrect))==null?void 0:g.length)>1},[e]),k=e.question.trim().replace(/(<([^>]+)>)/ig,"").trim().length<=1,N=a=>{if(c.length||p(1),S){let g=[...c],C=g.findIndex(T=>T._id===a._id);C>-1?g[C]=a:g.push(a),y(g)}else y([a]);A(g=>g+1)},l=k?V:z,x=(()=>{let a=S?H:P;return({position:g,index:C,option:T,isCorrect:$,_id:R,quesIndex:L,wasSelected:j})=>t(a,{_id:R,wasSelected:j,keyValue:`sub_option_${C}_${L}`,setAnswers:N,isMultiAnswersQuestion:k,position:g,option:T,index:C,isCorrect:$,isMarked:i},`sub_option_${C}_${L}`)})(),w=a=>!!c.find(g=>g._id===a||0);return v("div",{style:{marginLeft:"6px"},children:[t("span",{dangerouslySetInnerHTML:{__html:k?"":`
                        <div style="display:flex;flex-direction:row;">
                            <p style="margin-right:5px;">
                                ${i?_?'<span style="color:green;">&#10004;</span>':'<span style="color:red;">&#10008;</span>':""}${s+1}.  
                            </p>
                            <p><strong>
                            ${e.question}
                            </strong></p>
                        </div>
                    `}}),t(l,{index:s,isMarked:i,isCorrect:_,children:e.options.map(({option:a,isCorrect:g,_id:C},T)=>x({_id:C,position:s,index:s,quesIndex:T,option:a,wasSelected:w(C),isCorrect:g}))}),t("div",{style:{marginLeft:"15px",marginBottom:"10px"},hidden:!i,children:t("span",{dangerouslySetInnerHTML:{__html:`
                        <blockquote class="red lighten-5">
                            <span>
                                ${e.additionalInfo}
                            </span>
                        </blockquote>
                    `}})})]})},U=e=>{let s=5,n=e.length%s,p=Math.floor(e.length/s)+(n>0?1:0),m=new Array(p).fill([]);for(let o=0;o<p;o++)m[o]=e.slice(o*s,o*s+s);return m},W=(e,s,n=0)=>(p,m=!1)=>{let o=[];return p.forEach(d=>{let h=d.attempted_options[0].optionID,b=d.attempted_options[0].optionIndex,i=d.question;for(let c=0;c<s.length;c++){let y=s[c];if(y._id===i){let _=y.options.find((f,I)=>f._id===h||I===b);_&&o.push({position:c+1+n,option:_.option,isCorrect:_.isCorrect});break}}}),o.reduce((d,h)=>d.replace(new RegExp(`_{2,4}\\s?${h.position}\\s?_{2,4}`),`<span style="color:${m&&h.isCorrect?"green":"red"};"><u><b>${h.option}</b></u></span>`),e)},G=E.memo(({parentId:e,position:s,sub_questions:n,AddInternalPaperContents:p,setCorrectAnswersCount:m,setAttempted:o,compSubQuestionPage:d,savedChildren:h})=>{const b=r.exports.useCallback(_=>h.find(f=>f.question===_)||null,[n]);let i=r.exports.useMemo(()=>U(n||[]),[n]),c=i[d],y=i.slice(0,d).reduce((_,f)=>_+f.length,0);return t(Q,{children:c.map((_,f)=>t(J,{parentId:e,question:_,savedState:b(_._id),index:f+y+s,AddInternalPaperContents:p,setAttempted:o,setCorrectAnswersCount:m},f))})}),ee=({question:e,isMarked:s,position:n,setAttempted:p,setCorrectAnswersCount:m,AddPageStudentPaperContent:o,savedQuestion:d})=>{const{compSubQuestionPage:h,currentPage:b,attemptTree:i}=r.exports.useContext(M),[c,y]=r.exports.useState([]),[_,f]=r.exports.useState([]),[I,A]=r.exports.useState(e.question),S=r.exports.useMemo(()=>e.children[0].question.trim().replace(/(<([^>]+)>)/ig,"").trim().length<=1,[e]),k=S?W(e.question,e.children,n):l=>e.question,N=l=>{let u=[...c],x=u.findIndex(w=>w.question===l.question);x>-1?u[x]=l:u=[...u,l],y(u)};return r.exports.useEffect(()=>{c.length>0&&(o(e._id,{questionType:"comprehension",content:{question:e._id,children:c}}),S&&A(k(c,s)))},[c]),r.exports.useEffect(()=>{let l=document.querySelectorAll(".question-comp img");O.Materialbox.init(l);let u=i.pages[b].find(w=>w.content.question===e._id);if(!u)return;let x=u.content;y(x.children),f(x.children)},[]),v("div",{children:[t("span",{dangerouslySetInnerHTML:{__html:`<div class="question-comp">${I}</div>`}}),t("div",{style:{marginTop:"5px"},children:t(G,{AddInternalPaperContents:N,parentId:e._id,position:n,savedChildren:_,compSubQuestionPage:h,setAttempted:p,setCorrectAnswersCount:m,sub_questions:e.children||[]})})]})},te=({question:e,position:s,setAttempted:n,setCorrectAnswersCount:p,AddLibraryPaperContents:m,isMarked:o=!1})=>{const[d,h]=r.exports.useState(""),[b,i]=r.exports.useState(!1),c=f=>{const I=f.target.value;n(!d&&I?1:I?0:-1),h(f.target.value)},y=r.exports.useCallback(()=>d.toLocaleLowerCase()===e.answer.toLowerCase(),[d,e,o]),_=r.exports.useMemo(()=>e.subject.split(" ")[0].toLowerCase()==="kiswahili",[e]);return r.exports.useEffect(()=>{let f=y();i(f),p(f?1:0),m({questionType:"oldversion",content:{status:f,question:e._id,attempted_option:d}})},[o]),v("div",{className:"col s12",style:{marginBottom:"7px"},children:[v("div",{style:{display:"flex",flexDirection:"row"},children:[o?b?t("span",{style:{color:"green"},children:"\u2714"}):t("span",{style:{color:"red"},children:"\u2718"}):null,v("span",{style:{marginRight:"5px"},children:[s+1,". "]}),t("p",{children:v("span",{className:"left-align",children:[e.question,v("span",{className:"left-align",children:[t("br",{}),t("b",{children:e.options})]})]})})]}),v("div",{style:{marginLeft:"15px"},children:[v("div",{className:"input-field col s12",children:[t("input",{title:"Enter A B C or D",onChange:c,disabled:o,value:d,id:`trial_answer${s}`,required:!0,type:"text",className:"validate",style:{color:o?y()?"green":"red":"black"}}),t("label",{htmlFor:`trial_answer${s}`,children:_?"Jibu":"Answer"})]}),t("div",{hidden:!o,className:"col s12",children:t("blockquote",{className:"green lighten-5",style:{borderLeftColor:"#00e676"},children:v("p",{id:`correct_answer_display${s}`,className:"bold",children:[_?"Jibu Sahihi: ":"Correct Answer: ",e.answer]})})}),t("div",{hidden:!o,className:"col s12",children:t("blockquote",{className:"red lighten-5",children:t("p",{id:`additional_information${s}`,className:"bold",children:e.additionalInfo})})})]})]})},ne=E.memo(({onTimeUp:e})=>{const{isMarked:s}=r.exports.useContext(M),[n,p]=r.exports.useState(+`${localStorage.getItem("remainingTime")}`||0),[m,o]=r.exports.useState(!1),d=r.exports.useMemo(()=>B(n<0?0:n),[n]);return r.exports.useEffect(()=>{if(n<=0){o(!0),s||e();return}localStorage.setItem("remainingTime",`${n>=0?n:0}`)},[n]),r.exports.useEffect(()=>{if(!m||!s){let h=setInterval(()=>{p(b=>b-1e3)},1e3);return()=>{clearInterval(h)}}},[m]),t(Q,{children:t("button",{className:"waves-effect waves-light btn-small z-depth-0 white black-text",children:d})})});export{ee as C,q as N,te as O,ne as T};
