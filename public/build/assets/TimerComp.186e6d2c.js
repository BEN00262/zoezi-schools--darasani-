import{a as r,R as Q}from"./vendor.0b632b43.js";import{j as E,M as j}from"./App.17df74f4.js";import{a as v,j as t,F as B}from"./index.bae784dd.js";import{c as F}from"./millisecondsToTime.6095074a.js";const H=({option:e,_id:s,isCorrect:n,isMarked:c,index:m,position:i,setSuggestedAnswer:d,wasSelected:h})=>t("div",{children:t("p",{children:v("label",{children:[t("input",{type:"checkbox",className:"filled-in",disabled:c,checked:h||!1,onChange:C=>{d({option:e,isCorrect:n,_id:s})},name:`options_${i}`}),t("span",{className:c&&n?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})})},m),P=({option:e,_id:s,isCorrect:n,isMarked:c,index:m,position:i,setSuggestedAnswer:d,wasSelected:h})=>t("div",{children:t("p",{children:v("label",{children:[t("input",{disabled:c,onChange:C=>{d({option:e,isCorrect:n,_id:s})},required:!0,checked:h||!1,className:"with-gap",name:`options_${i}`,type:"radio"}),t("span",{className:c&&n?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})})},m),te=({question:e,position:s,isMarked:n,setAttempted:c,setCorrectAnswersCount:m,savedQuestion:i,AddPageStudentPaperContent:d})=>{const{currentPage:h,attemptTree:C}=r.exports.useContext(E),[l,a]=r.exports.useState([]),[b,x]=r.exports.useState(!1),g=r.exports.useMemo(()=>{var o,p;return((p=(o=e==null?void 0:e.options_next)==null?void 0:o.filter(f=>f.isCorrect))==null?void 0:p.length)||0},[e]),w=g>1||!1,A=o=>!!l.find(p=>p._id===o);r.exports.useEffect(()=>{let o=document.querySelectorAll(".question-comp img");j.Materialbox.init(o);let p=C.pages[h].find(I=>I.content.question===e._id);if(!p)return;let f=p.content,S=(e.options_next||[]).filter((I,L)=>f.attempted_options.findIndex(u=>u.optionID===I._id||u.optionIndex===L)>-1);x(S.length>0?S.every(I=>I.isCorrect):!1),a([...l,...S])},[]),r.exports.useEffect(()=>{l.length>0&&d(e._id,{questionType:"normal",content:{status:l.length>0?l.every(o=>o.isCorrect):!1,question:e._id,attempted_options:l.map(o=>({optionID:o._id,optionIndex:(e.options_next||[]).findIndex(p=>p._id===o._id)}))}})},[l]),r.exports.useEffect(()=>{if(n&&g===l.length){let o=l.length>0?l.every(p=>p.isCorrect):!1;x(o),m(o?1:0)}},[n]);const k=o=>{if(l.length||c(1),w){const p=l.findIndex(f=>f.option===o.option);if(p>-1){let f=[...l];f.splice(p),a(f),f.length||c(-1);return}a([...l,o]);return}a([o])},N=(()=>{let o=w?H:P;return({position:p,index:f,_id:S,option:I,isCorrect:L,wasSelected:u})=>t(o,{_id:S,setSuggestedAnswer:k,position:p,option:I,index:f,isCorrect:L,isMarked:n,wasSelected:u},f)})();return v("div",{children:[t("span",{dangerouslySetInnerHTML:{__html:`
                    <div style="display:flex;flex-direction:row;">
                        ${n?b?'<span style="color:green;">&#10004;</span>':'<span style="color:red;">&#10008;</span>':""} 
                        <p style="margin-right:5px;">${s+1}.  </p><strong class="question-comp">${e.question}</strong>
                    </div>
                `}}),t("div",{style:{marginTop:"10px",marginLeft:"17px",marginBottom:"10px"},children:e.options_next&&e.options_next.map(({option:o,isCorrect:p,_id:f},S)=>N({position:s,_id:f,option:o,index:S,isCorrect:p,wasSelected:A(f)}))}),t("div",{style:{marginLeft:"17px",marginBottom:"10px"},hidden:!n,children:t("span",{dangerouslySetInnerHTML:{__html:`
                        <blockquote class="red lighten-5">
                            <span>
                            ${e.additionalInfo}
                            </span>
                        </blockquote>
                    `}})})]})},V=({option:e,wasSelected:s,isCorrect:n,_id:c,isMarked:m,index:i,position:d,setAnswers:h,isMultiAnswersQuestion:C})=>t("div",{children:t("p",{children:v("label",{children:[t("input",{type:"checkbox",checked:s,className:"filled-in",disabled:m,onChange:l=>{h({option:e,isCorrect:n,_id:c})},required:!0,name:`sub_option_answer_${d}`}),t("span",{className:m&&n?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})})},i),z=({option:e,wasSelected:s,isCorrect:n,_id:c,isMarked:m,keyValue:i,position:d,setAnswers:h,isMultiAnswersQuestion:C})=>t("p",{children:v("label",{children:[t("input",{disabled:m,checked:s,required:!0,onChange:l=>{h({option:e,isCorrect:n,_id:c})},className:"with-gap",type:"radio",name:`sub_option_answer_${d}`}),t("span",{className:m&&n?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})},i),J=({children:e,index:s,isMarked:n,isCorrect:c})=>v("div",{style:{marginLeft:"15px",marginTop:"5px",marginBottom:"5px",display:"flex",flexDirection:"row"},children:[n?c?t("span",{style:{color:"green"},children:"\u2714"}):t("span",{style:{color:"red"},children:"\u2718"}):null,s+1,".",t("div",{children:e})]}),U=({children:e,index:s})=>t("div",{style:{marginLeft:"15px",marginTop:"5px",marginBottom:"5px"},children:e}),W=({question:e,index:s,AddInternalPaperContents:n,setAttempted:c,setCorrectAnswersCount:m,savedState:i,parentId:d})=>{const{attemptTree:h,currentPage:C,isMarked:l}=r.exports.useContext(E),[a,b]=r.exports.useState([]),[x,g]=r.exports.useState(!1),[w,A]=r.exports.useState(0),[k,M]=r.exports.useState(-1);r.exports.useEffect(()=>{let u=h.pages[C].find($=>$.content.question===d);if(!u)return;let y=u.content.children.find($=>$.question===e._id);if(!y)return;let T=(e.options||[]).filter(($,O)=>y?y.attempted_options.findIndex(R=>R.optionID===$._id||R.optionIndex===O)>-1:!1);g(y.status),b([...a,...T]),M(Math.random())},[]),r.exports.useEffect(()=>{if(l&&a.length>0){let u=a.every(_=>_.isCorrect);g(u)}},[l,a]),r.exports.useEffect(()=>{w>0&&n({status:a.length?a.every(u=>u.isCorrect):!1,question:e._id,attempted_options:a.map(u=>({optionID:u._id,optionIndex:e.options.findIndex(_=>_._id===u._id)}))})},[w]);const N=r.exports.useMemo(()=>{var u,_;return((_=(u=e==null?void 0:e.options)==null?void 0:u.filter(y=>y.isCorrect))==null?void 0:_.length)>1},[e]),o=e.question.trim().replace(/(<([^>]+)>)/ig,"").trim().length<=1,p=u=>{if(a.length||c(1),N){let _=[...a],y=_.findIndex(T=>T._id===u._id);y>-1?_[y]=u:_.push(u),b(_)}else b([u]);A(_=>_+1)},f=o?J:U,I=(()=>{let u=N?V:z;return({position:_,index:y,option:T,isCorrect:$,_id:O,quesIndex:R,wasSelected:D})=>t(u,{_id:O,wasSelected:D,keyValue:`sub_option_${y}_${R}`,setAnswers:p,isMultiAnswersQuestion:o,position:_,option:T,index:y,isCorrect:$,isMarked:l},`sub_option_${y}_${R}`)})(),L=u=>!!a.find(_=>_._id===u||0);return v("div",{style:{marginLeft:"6px"},children:[t("span",{dangerouslySetInnerHTML:{__html:o?"":`
                        <div style="display:flex;flex-direction:row;">
                            <p style="margin-right:5px;">
                                ${l?x?'<span style="color:green;">&#10004;</span>':'<span style="color:red;">&#10008;</span>':""}${s+1}.  
                            </p>
                            <p><strong>
                            ${e.question}
                            </strong></p>
                        </div>
                    `}}),t(f,{index:s,isMarked:l,isCorrect:x,children:e.options.map(({option:u,isCorrect:_,_id:y},T)=>I({_id:y,position:s,index:s,quesIndex:T,option:u,wasSelected:L(y),isCorrect:_}))},k),t("div",{style:{marginLeft:"15px",marginBottom:"10px"},hidden:!l,children:t("span",{dangerouslySetInnerHTML:{__html:`
                        <blockquote class="red lighten-5">
                            <span>
                                ${e.additionalInfo}
                            </span>
                        </blockquote>
                    `}})})]})},G=e=>{let s=5,n=e.length%s,c=Math.floor(e.length/s)+(n>0?1:0),m=new Array(c).fill([]);for(let i=0;i<c;i++)m[i]=e.slice(i*s,i*s+s);return m},K=(e,s,n=0)=>(c,m=!1)=>{let i=[];return c.forEach(d=>{let h=d.attempted_options[0].optionID,C=d.attempted_options[0].optionIndex,l=d.question;for(let a=0;a<s.length;a++){let b=s[a];if(b._id===l){let x=b.options.find((g,w)=>g._id===h||w===C);x&&i.push({position:a+1+n,option:x.option,isCorrect:x.isCorrect});break}}}),i.reduce((d,h)=>d.replace(new RegExp(`_{2,4}\\s?${h.position}\\s?_{2,4}`),`<span style="color:${m&&h.isCorrect?"green":"red"};"><u><b>${h.option}</b></u></span>`),e)},X=Q.memo(({parentId:e,position:s,sub_questions:n,AddInternalPaperContents:c,setCorrectAnswersCount:m,setAttempted:i,compSubQuestionPage:d,savedChildren:h})=>{const C=r.exports.useCallback(x=>h.find(g=>g.question===x)||null,[n]);let l=r.exports.useMemo(()=>G(n||[]),[n]),a=l[d],b=l.slice(0,d).reduce((x,g)=>x+g.length,0);return t(B,{children:a.map((x,g)=>t(W,{parentId:e,question:x,savedState:C(x._id),index:g+b+s,AddInternalPaperContents:c,setAttempted:i,setCorrectAnswersCount:m},g))})}),ne=({question:e,isMarked:s,position:n,setAttempted:c,setCorrectAnswersCount:m,AddPageStudentPaperContent:i,savedQuestion:d})=>{const{compSubQuestionPage:h,currentPage:C,attemptTree:l}=r.exports.useContext(E),[a,b]=r.exports.useState([]),[x,g]=r.exports.useState([]),[w,A]=r.exports.useState(e.question),k=r.exports.useMemo(()=>e.children[0].question.trim().replace(/(<([^>]+)>)/ig,"").trim().length<=1,[e]),M=k?K(e.question,e.children,n):o=>e.question,N=o=>{let p=[...a],f=p.findIndex(S=>S.question===o.question);f>-1?p[f]=o:p=[...p,o],b(p)};return r.exports.useEffect(()=>{a.length>0&&(i(e._id,{questionType:"comprehension",content:{question:e._id,children:a}}),k&&A(M(a,s)))},[a]),r.exports.useEffect(()=>{let o=document.querySelectorAll(".question-comp img");j.Materialbox.init(o);let p=l.pages[C].find(S=>S.content.question===e._id);if(!p)return;let f=p.content;b(f.children),g(f.children)},[]),v("div",{children:[t("span",{dangerouslySetInnerHTML:{__html:`<div class="question-comp">${w}</div>`}}),t("div",{style:{marginTop:"5px"},children:t(X,{AddInternalPaperContents:N,parentId:e._id,position:n,savedChildren:x,compSubQuestionPage:h,setAttempted:c,setCorrectAnswersCount:m,sub_questions:e.children||[]})})]})},se=({question:e,position:s,setAttempted:n,setCorrectAnswersCount:c,AddLibraryPaperContents:m,isMarked:i=!1})=>{const[d,h]=r.exports.useState(""),[C,l]=r.exports.useState(!1),a=g=>{const w=g.target.value;n(!d&&w?1:w?0:-1),h(g.target.value)},b=r.exports.useCallback(()=>d.toLocaleLowerCase()===e.answer.toLowerCase(),[d,e,i]),x=r.exports.useMemo(()=>e.subject.split(" ")[0].toLowerCase()==="kiswahili",[e]);return r.exports.useEffect(()=>{let g=b();l(g),c(g?1:0),m({questionType:"oldversion",content:{status:g,question:e._id,attempted_option:d}})},[i]),v("div",{className:"col s12",style:{marginBottom:"7px"},children:[v("div",{style:{display:"flex",flexDirection:"row"},children:[i?C?t("span",{style:{color:"green"},children:"\u2714"}):t("span",{style:{color:"red"},children:"\u2718"}):null,v("span",{style:{marginRight:"5px"},children:[s+1,". "]}),t("p",{children:v("span",{className:"left-align",children:[e.question,v("span",{className:"left-align",children:[t("br",{}),t("b",{children:e.options})]})]})})]}),v("div",{style:{marginLeft:"15px"},children:[v("div",{className:"input-field col s12",children:[t("input",{title:"Enter A B C or D",onChange:a,disabled:i,value:d,id:`trial_answer${s}`,required:!0,type:"text",className:"validate",style:{color:i?b()?"green":"red":"black"}}),t("label",{htmlFor:`trial_answer${s}`,children:x?"Jibu":"Answer"})]}),t("div",{hidden:!i,className:"col s12",children:t("blockquote",{className:"green lighten-5",style:{borderLeftColor:"#00e676"},children:v("p",{id:`correct_answer_display${s}`,className:"bold",children:[x?"Jibu Sahihi: ":"Correct Answer: ",e.answer]})})}),t("div",{hidden:!i,className:"col s12",children:t("blockquote",{className:"red lighten-5",children:t("p",{id:`additional_information${s}`,className:"bold",children:e.additionalInfo})})})]})]})},re=Q.memo(({onTimeUp:e})=>{const{isMarked:s}=r.exports.useContext(E),[n,c]=r.exports.useState(+`${localStorage.getItem("remainingTime")}`||0),[m,i]=r.exports.useState(!1),d=r.exports.useMemo(()=>F(n<0?0:n),[n]);return r.exports.useEffect(()=>{if(n<=0){i(!0),s||e();return}localStorage.setItem("remainingTime",`${n>=0?n:0}`)},[n]),r.exports.useEffect(()=>{if(!m||!s){let h=setInterval(()=>{c(C=>C-1e3)},1e3);return()=>{clearInterval(h)}}},[m]),t(B,{children:t("button",{className:"waves-effect waves-light btn-small z-depth-0 white black-text",children:d})})});export{ne as C,te as N,se as O,re as T};
