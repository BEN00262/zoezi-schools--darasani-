var J=Object.defineProperty,Y=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var M=(l,s,t)=>s in l?J(l,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[s]=t,j=(l,s)=>{for(var t in s||(s={}))se.call(s,t)&&M(l,t,s[t]);if(z)for(var t of z(s))te.call(s,t)&&M(l,t,s[t]);return l},Q=(l,s)=>Y(l,ee(s));import{r as B,G as O,s as ae,l as le,v as re,w as ne,x as ie,R as A,y as oe,z as ce,A as de,C as ue,a as pe,L as me,B as he,p as be,b as ge,c as fe,D as F,u as xe,n as _e,d as ye,e as Se,M as ve,f as $,k as Ne,S as G,g as Te}from"./App.fbfe1e5a.js";import{R as P,r as a}from"./vendor.c3066ab3.js";import{c as Ce}from"./millisecondsToTime.26b2335e.js";import{_ as V,j as e,L as H,F as E,a as i}from"./index.e1943286.js";const Re=P.lazy(()=>V(()=>import("./question_comp.7f46fedd.js"),["assets/question_comp.7f46fedd.js","assets/App.fbfe1e5a.js","assets/App.bede793c.css","assets/vendor.c3066ab3.js","assets/index.e1943286.js","assets/index.08e28fc4.css","assets/old_version_question.6e828e67.js"])),De=({tree:l})=>(console.log(l),e(a.exports.Suspense,{fallback:e(H,{}),children:l&&e(Re,{paper:l})})),we=P.lazy(()=>V(()=>import("./question_comp.80381584.js"),["assets/question_comp.80381584.js","assets/vendor.c3066ab3.js","assets/App.fbfe1e5a.js","assets/App.bede793c.css","assets/index.e1943286.js","assets/index.08e28fc4.css","assets/TimerComp.b5ccd052.js","assets/millisecondsToTime.26b2335e.js","assets/old_version_question.5c67416b.js"]));function ke({wasTimed:l}){const s=B(K),t=B(U),{subject:p,currentPage:c,compSubQuestionPage:d,updateNoQuesPerPage:b,questions:g,paperMap:u}=a.exports.useContext(O),[N,m]=a.exports.useState([]),[S,T]=a.exports.useState(0),[f,x]=a.exports.useState(-1),y=a.exports.useMemo(()=>p.split(" ")[0].toLowerCase()==="kiswahili",[p]);return a.exports.useEffect(()=>{T(ae(g,u,c));const _=u.pages[c];b(_.endIndex-_.startIndex),m(g.slice(_.startIndex,_.endIndex)),x(Math.random()),s(c)},[c]),a.exports.useEffect(()=>{t(d)},[d]),e(E,{children:e(a.exports.Suspense,{fallback:e(le.Container,{children:y?"Karatasi inatayarishwa ...":"Preparing paper ..."}),children:e(we,{questions:N,alreadyDone:S,isKiswahili:y,wasTimed:l})},f)})}const Ae=({gradeName:l,prePaper:s,prePrevState:t})=>{const p=A(K),c=A(U),{updateQuestions:d,setSubjectName:b}=a.exports.useContext(O),[g,u]=a.exports.useState(),[N,m]=a.exports.useState(!1),[S,T]=a.exports.useState(-1);return a.exports.useEffect(()=>{var D,C,w,v,k;u(s),b((s==null?void 0:s.subject)||"");const f=oe((s==null?void 0:s.questions)||[]),x=ce((s==null?void 0:s.questions)||[]),y=p>-1?p:t.currentPage||0,_=c>-1?c:t.compSubQuestionPage||0;d({questions:(s==null?void 0:s.questions)||[],paperMap:f,gradeName:l,paperID:"paperid_something",isLibraryPaper:!0,paperHistoryID:t._id||"",currentPage:y,compSubQuestionPage:_,isMarked:t.isMarked||!1,isTimed:t.isTimed||(g==null?void 0:g.isTimed)||!1,remainingTime:t.remainingTime||1e4,numOfQuestions:x,totalPages:Object.keys(f.pages).length,attemptTree:{subject:(s==null?void 0:s.subject)||"",score:{passed:((C=(D=t==null?void 0:t.attemptTree)==null?void 0:D.score)==null?void 0:C.passed)||0,total:((v=(w=t==null?void 0:t.attemptTree)==null?void 0:w.score)==null?void 0:v.total)||x},pages:((k=t==null?void 0:t.attemptTree)==null?void 0:k.pages)||de(f,(s==null?void 0:s.questions)||[])}}),m(!0),T(Math.random())},[t]),g?N?e(ke,{wasTimed:!1},S):null:e(H,{})},Le=l=>e(re,{children:e(ne,{children:e(ie,{children:e(Ae,j({},l))})})});ue.register(pe,me,he,be,ge,fe);const je=(l,s)=>({indexAxis:s?"y":"x",responsive:!0,maintainAspectRatio:!1,redraw:!0,plugins:{legend:{position:"top"},title:{display:!0,text:l},barValueSpacing:40,tooltips:{displayColors:!0,callbacks:{mode:"x"}},datalabels:{display:t=>!1},scales:{xAxes:[{gridLines:{display:!0,drawBorder:!1}}],yAxes:[{gridLines:{display:!1,drawBorder:!0}}]}}}),$e=l=>{if(l.length<=1)return"First attempt";const t=l.reduce((c,d)=>[...c,d.pass-d.fail],[]),p=(t.length>2?t.slice(Math.max(t.length-2,1)):t).reduce((c,d)=>d-c,0);return p===0?"No change":p<0?"Declining":"Improving"},K=F({key:"currentlySavedPageNumberId",default:-1}),U=F({key:"currentlySavedSubPageNumberId",default:-1}),Be=({subject:l})=>{const{authToken:s}=xe(),[t,p]=a.exports.useState([]),[c,d]=a.exports.useState([]),[b,g]=a.exports.useState(""),[u,N]=a.exports.useState({firstname:"",lastname:"",profilePic:"",gender:null}),[m,S]=a.exports.useState({isSpecial:!1,label:"",value:""}),[T,f]=a.exports.useState([]),[x,y]=a.exports.useState({pass:[],fail:[]}),[_,D]=a.exports.useState("First attempt"),[C,w]=a.exports.useState(0),[v,k]=a.exports.useState(0),[o,W]=a.exports.useState({isSpecial:!1,paper:{},trees:[],prevStates:[]}),X=!1,L=A(_e),Z=A(ye),{isSuccess:I,data:q}=Se(["in_app_subject_analysis_students",L],()=>$.get(`/api/grade/learners/${L}`,{headers:{Authorization:`Bearer ${s}`}}).then(({data:r})=>{if(r)return r.learners.map(n=>({label:`${n.firstname} ${n.lastname}`,value:n._id}));throw new Error("Unexpected error!")}),{enabled:!!s&&!!L,staleTime:1*60*1e3});return a.exports.useEffect(()=>{ve.Tabs.init(document.querySelector(".sub-tabs"),{})},[]),a.exports.useEffect(()=>{I&&q&&p(q)},[I]),a.exports.useEffect(()=>{m&&m.value&&$.get(`/api/analytics/learner/${b}/${m.value}${m.isSpecial?"/special":""}`,{headers:{Authorization:`Bearer ${s}`}}).then(({data:r})=>{if(r){const n=[...r.plottable||[]].reverse();y({pass:n.map(h=>h.score.passed),fail:n.map(h=>h.score.total-h.score.passed)}),w(r.time_per_question),D($e(n.map(h=>({pass:h.score.passed,fail:h.score.total-h.score.passed}))));const R=r.attempt_trees;W(Q(j({},R),{trees:[...R.trees].reverse(),prevStates:[...R.prevStates].reverse()})),f(n);return}})},[m]),a.exports.useEffect(()=>{b&&(d([]),S(null),y({fail:[],pass:[]}),f([]),$.get(`/api/analytics/subject/${Z}/${b}/${l}`,{headers:{Authorization:`Bearer ${s}`}}).then(({data:r})=>{if(r){N(r.student),d(r.papersDone.map(n=>({label:`${l} ( ${n.subject} )`,value:n.paperID,isSpecial:n.isSpecial})));return}}))},[b]),i("div",{className:"row",children:[u.firstname?e("div",{className:"col s12 center",children:i("div",{style:{margin:"auto"},children:[e("img",{style:{height:"100px",width:"100px",objectFit:"contain",border:"1px solid #d3d3d3",borderRadius:"50%"},src:u.profilePic?u.profilePic:Ne(u.gender)}),e("br",{}),e("span",{className:"sub-modal-texts",style:{letterSpacing:"1px"},children:i("b",{children:[u.firstname," ",u.lastname]})}),c.length?null:i(E,{children:[" ",e("span",{className:"sub-modal-texts",style:{border:"1px solid red",padding:"1px 10px",borderRadius:"20px"},children:e("b",{children:"has not attempted any paper(s)"})})]})]})}):null,e("div",{className:"col s12",children:i("ul",{className:"sub-tabs tabs tabs-fixed-width",style:{overflowX:"hidden"},children:[e("li",{className:"tab col s6",children:e("a",{href:"#analytics",className:"active",children:"Analytics"})}),e("li",{className:`tab col s6 ${o.trees.length||o.prevStates.length?"":"disabled"}`,children:i("a",{href:"#lastDonePapers",children:["Last (",o.trees.length||o.prevStates.length,") Paper(s)"]})})]})}),i("div",{id:"analytics",children:[e("div",{className:"col s12 m12 l4",children:e("div",{className:"card z-depth-0",style:{border:"1px solid #dcdee2"},children:i("div",{className:"card-content",children:[i("div",{className:"row",children:[i("div",{className:"col s12 m12",children:[e("label",{children:"Learner"}),e(G,{hideSelectedOptions:!0,onChange:r=>{g((r==null?void 0:r.value)||"")},options:t,placeholder:"select learner..."})]}),i("div",{className:"col s12 m12",children:[e("label",{children:"Paper"}),e(G,{hideSelectedOptions:!0,isDisabled:!b||!c.length,options:c,value:m,onChange:r=>{S(r||{})},placeholder:"select paper..."})]})]}),e("div",{className:"row",id:"performanceReportButton",hidden:!0,children:e("div",{className:"col s12 m12",children:i("button",{onClick:()=>{},"data-position":"bottom","data-tooltip":"Scroll down to view or download the report",className:"btn-small sub-modal-texts tooltipped white black-text waves-effect waves-black z-depth-1",style:{width:"100%",fontWeight:"bold"},children:["PERFORMANCE REPORT",e("i",{className:"material-icons right",children:"assessment"})]})})})]})})}),i("div",{className:"col s12 m12 l8",children:[T.length?e("div",{className:"card z-depth-0",style:{border:"1px solid #dcdee2"},children:i("div",{className:"card-content sub-modal-texts center",children:["Remarks: ",e("span",{style:{border:"1px solid green",padding:"1px 2px",borderRadius:"2px"},children:e("b",{children:_})}),C>0?i(E,{children:[" ",e("b",{children:"|"})," ","Av. Time Per Question: ",e("span",{style:{border:"1px solid green",padding:"1px 2px",borderRadius:"2px"},children:e("b",{children:Ce(C,!0)})})]}):null]})}):null,e("div",{className:"card z-depth-0",style:{border:"1px solid #dcdee2"},children:e("div",{className:"card-content",children:e("div",{className:"row",id:"insertChart",children:e(Te,{options:je("Performance Analysis",X),style:{height:"300px"},data:{labels:x.pass.map((r,n)=>`Attempt ${n+1}`),datasets:[{label:"Pass",data:x.pass,backgroundColor:"#00c853"},{label:"Fail",data:x.fail,backgroundColor:"#f44336"}]}})})})})]})]}),e("div",{id:"lastDonePapers",children:(o.isSpecial?o.prevStates.length:o.trees.length)?e("div",{className:"col s12 m12",children:i("div",{className:"section",children:[i("div",{className:"col s12",children:[(o.isSpecial?o.prevStates:o.trees).map((r,n)=>{const R=o.isSpecial?r.attemptTree.score.passed:r.score.passed,h=o.isSpecial?r.attemptTree.score.total:r.score.total;return e("button",{className:`btn-flat sub-modal-texts ${v===n?"teal lighten-5":""}`,style:{border:"1px solid #d3d3d3",borderTop:"2px solid #80cbc4",borderRadius:"5px 5px 0px 0px",marginRight:"1px"},onClick:Ee=>{k(n)},children:i("b",{children:["Attempt ",n+1," ",i("span",{className:"red-text sub-names",children:["( ",R," / ",h,")"]})]})},`attempt_pill_${n}`)}),e("div",{className:"divider",style:{marginBottom:"5px"}})]}),e("div",{className:"col s12",children:o.isSpecial?e(Le,{gradeName:"Sample Grade",prePaper:o.paper,prePrevState:o.prevStates[v]}):e(De,{tree:o.trees[v]})})]})}):null})]})};export{K as currentlySavedPageNumberState,U as currentlySavedSubPageNumberState,Be as default,je as options};
