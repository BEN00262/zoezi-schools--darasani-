import{a as r,R as P}from"./vendor.0b632b43.js";import{n as R,M as E}from"./App.1e349059.js";import{a as y,j as t,F as O}from"./index.b5385275.js";import{c as B}from"./millisecondsToTime.6095074a.js";const D=({option:e,_id:s,isCorrect:n,isMarked:c,index:d,position:o,setSuggestedAnswer:l,wasSelected:m})=>t("div",{children:t("p",{children:y("label",{children:[t("input",{type:"checkbox",className:"filled-in",disabled:c,checked:m||!1,onChange:C=>{l({option:e,isCorrect:n,_id:s})},name:`options_${o}`}),t("span",{className:c&&n?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})})},d),H=({option:e,_id:s,isCorrect:n,isMarked:c,index:d,position:o,setSuggestedAnswer:l,wasSelected:m})=>t("div",{children:t("p",{children:y("label",{children:[t("input",{disabled:c,onChange:C=>{l({option:e,isCorrect:n,_id:s})},required:!0,checked:m||!1,className:"with-gap",name:`options_${o}`,type:"radio"}),t("span",{className:c&&n?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})})},d),q=({question:e,position:s,isMarked:n,setAttempted:c,setCorrectAnswersCount:d,savedQuestion:o,AddPageStudentPaperContent:l})=>{const{currentPage:m,attemptTree:C}=r.exports.useContext(R),[i,u]=r.exports.useState([]),[v,x]=r.exports.useState(!1),g=r.exports.useMemo(()=>{var p,f;return((f=(p=e==null?void 0:e.options_next)==null?void 0:p.filter(b=>b.isCorrect))==null?void 0:f.length)||0},[e]),w=g>1||!1,A=p=>!!i.find(f=>f._id===p);r.exports.useEffect(()=>{let p=document.querySelectorAll(".question-comp img");E.Materialbox.init(p);let f=C.pages[m].find(a=>a.content.question===e._id);if(!f)return;let b=f.content,S=(e.options_next||[]).filter((a,h)=>b.attempted_options.findIndex(_=>_.optionID===a._id||_.optionIndex===h)>-1);x(S.length>0?S.every(a=>a.isCorrect):!1),u([...i,...S])},[]),r.exports.useEffect(()=>{i.length>0&&l(e._id,{questionType:"normal",content:{status:i.length>0?i.every(p=>p.isCorrect):!1,question:e._id,attempted_options:i.map(p=>({optionID:p._id,optionIndex:(e.options_next||[]).findIndex(f=>f._id===p._id)}))}})},[i]),r.exports.useEffect(()=>{if(n&&g===i.length){let p=i.length>0?i.every(f=>f.isCorrect):!1;x(p),d(p?1:0)}},[n]);const I=p=>{if(i.length||c(1),w){const f=i.findIndex(b=>b.option===p.option);if(f>-1){let b=[...i];b.splice(f),u(b),b.length||c(-1);return}u([...i,p]);return}u([p])},N=(()=>{let p=w?D:H;return({position:f,index:b,_id:S,option:a,isCorrect:h,wasSelected:_})=>t(p,{_id:S,setSuggestedAnswer:I,position:f,option:a,index:b,isCorrect:h,isMarked:n,wasSelected:_},b)})();return y("div",{children:[t("span",{dangerouslySetInnerHTML:{__html:`
                    <div style="display:flex;flex-direction:row;">
                        ${n?v?'<span style="color:green;">&#10004;</span>':'<span style="color:red;">&#10008;</span>':""} 
                        <p style="margin-right:5px;">${s+1}.  </p><strong class="question-comp">${e.question}</strong>
                    </div>
                `}}),t("div",{style:{marginTop:"10px",marginLeft:"17px",marginBottom:"10px"},children:e.options_next&&e.options_next.map(({option:p,isCorrect:f,_id:b},S)=>N({position:s,_id:b,option:p,index:S,isCorrect:f,wasSelected:A(b)}))}),t("div",{style:{marginLeft:"17px",marginBottom:"10px"},hidden:!n,children:t("span",{dangerouslySetInnerHTML:{__html:`
                        <blockquote class="red lighten-5">
                            <span>
                            ${e.additionalInfo}
                            </span>
                        </blockquote>
                    `}})})]})},j=({option:e,wasSelected:s,isCorrect:n,_id:c,isMarked:d,index:o,position:l,setAnswers:m,isMultiAnswersQuestion:C})=>t("div",{children:t("p",{children:y("label",{children:[t("input",{type:"checkbox",checked:s,className:"filled-in",disabled:d,onChange:i=>{m({option:e,isCorrect:n,_id:c})},required:!0,name:`sub_option_answer_${l}`}),t("span",{className:d&&n?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})})},o),F=({option:e,wasSelected:s,isCorrect:n,_id:c,isMarked:d,keyValue:o,position:l,setAnswers:m,isMultiAnswersQuestion:C})=>t("p",{children:y("label",{children:[t("input",{disabled:d,checked:s,required:!0,onChange:i=>{m({option:e,isCorrect:n,_id:c})},className:"with-gap",type:"radio",name:`sub_option_answer_${l}`}),t("span",{className:d&&n?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})},o),V=({children:e,index:s,isMarked:n,isCorrect:c})=>y("div",{style:{marginLeft:"15px",marginTop:"5px",marginBottom:"5px",display:"flex",flexDirection:"row"},children:[n?c?t("span",{style:{color:"green"},children:"\u2714"}):t("span",{style:{color:"red"},children:"\u2718"}):null,s+1,".",t("div",{children:e})]}),z=({children:e,index:s})=>t("div",{style:{marginLeft:"15px",marginTop:"5px",marginBottom:"5px"},children:e}),J=({question:e,index:s,AddInternalPaperContents:n,setAttempted:c,setCorrectAnswersCount:d,savedState:o,parentId:l})=>{const{attemptTree:m,currentPage:C,isMarked:i}=r.exports.useContext(R),[u,v]=r.exports.useState([]),[x,g]=r.exports.useState(!1),[w,A]=r.exports.useState(0);r.exports.useEffect(()=>{let a=m.pages[C].find($=>$.content.question===l);if(!a)return;let _=a.content.children.find($=>$.question===e._id);if(!_)return;let T=(e.options||[]).filter(($,M)=>_?_.attempted_options.findIndex(L=>L.optionID===$._id||L.optionIndex===M)>-1:!1);g(_.status),v([...u,...T])},[]),r.exports.useEffect(()=>{if(i&&u.length>0){let a=u.every(h=>h.isCorrect);g(a)}},[i,u]),r.exports.useEffect(()=>{w>0&&n({status:u.length?u.every(a=>a.isCorrect):!1,question:e._id,attempted_options:u.map(a=>({optionID:a._id,optionIndex:e.options.findIndex(h=>h._id===a._id)}))})},[w]);const I=r.exports.useMemo(()=>{var a,h;return((h=(a=e==null?void 0:e.options)==null?void 0:a.filter(_=>_.isCorrect))==null?void 0:h.length)>1},[e]),k=e.question.trim().replace(/(<([^>]+)>)/ig,"").trim().length<=1,N=a=>{if(u.length||c(1),I){let h=[...u],_=h.findIndex(T=>T._id===a._id);_>-1?h[_]=a:h.push(a),v(h)}else v([a]);A(h=>h+1)},p=k?V:z,b=(()=>{let a=I?j:F;return({position:h,index:_,option:T,isCorrect:$,_id:M,quesIndex:L,wasSelected:Q})=>t(a,{_id:M,wasSelected:Q,keyValue:`sub_option_${_}_${L}`,setAnswers:N,isMultiAnswersQuestion:k,position:h,option:T,index:_,isCorrect:$,isMarked:i},`sub_option_${_}_${L}`)})(),S=a=>!!u.find(h=>h._id===a||0);return y("div",{style:{marginLeft:"6px"},children:[t("span",{dangerouslySetInnerHTML:{__html:k?"":`
                        <div style="display:flex;flex-direction:row;">
                            <p style="margin-right:5px;">
                                ${i?x?'<span style="color:green;">&#10004;</span>':'<span style="color:red;">&#10008;</span>':""}${s+1}.  
                            </p>
                            <p><strong>
                            ${e.question}
                            </strong></p>
                        </div>
                    `}}),t(p,{index:s,isMarked:i,isCorrect:x,children:e.options.map(({option:a,isCorrect:h,_id:_},T)=>b({_id:_,position:s,index:s,quesIndex:T,option:a,wasSelected:S(_),isCorrect:h}))}),t("div",{style:{marginLeft:"15px",marginBottom:"10px"},hidden:!i,children:t("span",{dangerouslySetInnerHTML:{__html:`
                        <blockquote class="red lighten-5">
                            <span>
                                ${e.additionalInfo}
                            </span>
                        </blockquote>
                    `}})})]})},U=e=>{let s=5,n=e.length%s,c=Math.floor(e.length/s)+(n>0?1:0),d=new Array(c).fill([]);for(let o=0;o<c;o++)d[o]=e.slice(o*s,o*s+s);return d},W=(e,s,n=0)=>(c,d=!1)=>{let o=[];return c.forEach(l=>{let m=l.attempted_options[0].optionID,C=l.attempted_options[0].optionIndex,i=l.question;for(let u=0;u<s.length;u++){let v=s[u];if(v._id===i){let x=v.options.find((g,w)=>g._id===m||w===C);x&&o.push({position:u+1+n,option:x.option,isCorrect:x.isCorrect});break}}}),o.reduce((l,m)=>l.replace(new RegExp(`_{2,4}\\s?${m.position}\\s?_{2,4}`),`<span style="color:${d&&m.isCorrect?"green":"red"};"><u><b>${m.option}</b></u></span>`),e)},G=({parentId:e,position:s,sub_questions:n,setCorrectAnswersCount:c,setAttempted:d,savedChildren:o})=>{const{compSubQuestionPage:l,currentPage:m}=r.exports.useContext(R),C=r.exports.useCallback(x=>o.find(g=>g.question===x)||null,[n]);let i=r.exports.useMemo(()=>U(n||[]),[n]),u=i[l],v=i.slice(0,l).reduce((x,g)=>x+g.length,0);return t(O,{children:u.map((x,g)=>t(J,{parentId:e,question:x,savedState:C(x._id),index:g+v+s,AddInternalPaperContents:w=>{},setAttempted:d,setCorrectAnswersCount:c},g))})},ee=({question:e,isMarked:s,position:n,setAttempted:c,setCorrectAnswersCount:d})=>{const{compSubQuestionPage:o,currentPage:l,attemptTree:m}=r.exports.useContext(R);console.log(e._id);const[C,i]=r.exports.useState([]),[u,v]=r.exports.useState([]),[x,g]=r.exports.useState(e.question),[w,A]=r.exports.useState(-1),I=r.exports.useMemo(()=>e.children[0].question.trim().replace(/(<([^>]+)>)/ig,"").trim().length<=1,[e]),k=I?W(e.question,e.children,n):N=>e.question;return r.exports.useEffect(()=>{C.length>0&&I&&g(k(C,s))},[C]),r.exports.useEffect(()=>{let N=document.querySelectorAll(".question-comp img");E.Materialbox.init(N);let p=m.pages[l].find(b=>b.content.question===e._id);if(!p)return;let f=p.content;i(f.children),v(f.children)},[]),r.exports.useEffect(()=>{A(Math.random()),console.log(`The current sub page is ${o}`)},[l]),y("div",{children:[t("span",{dangerouslySetInnerHTML:{__html:`<div class="question-comp">${x}</div>`}}),t("div",{style:{marginTop:"5px"},children:t(G,{parentId:e._id,position:n,savedChildren:u,setAttempted:c,setCorrectAnswersCount:d,sub_questions:e.children||[]},w)})]})},te=({question:e,position:s,setAttempted:n,setCorrectAnswersCount:c,AddLibraryPaperContents:d,isMarked:o=!1})=>{const[l,m]=r.exports.useState(""),[C,i]=r.exports.useState(!1),u=g=>{const w=g.target.value;n(!l&&w?1:w?0:-1),m(g.target.value)},v=r.exports.useCallback(()=>l.toLocaleLowerCase()===e.answer.toLowerCase(),[l,e,o]),x=r.exports.useMemo(()=>e.subject.split(" ")[0].toLowerCase()==="kiswahili",[e]);return r.exports.useEffect(()=>{let g=v();i(g),c(g?1:0),d({questionType:"oldversion",content:{status:g,question:e._id,attempted_option:l}})},[o]),y("div",{className:"col s12",style:{marginBottom:"7px"},children:[y("div",{style:{display:"flex",flexDirection:"row"},children:[o?C?t("span",{style:{color:"green"},children:"\u2714"}):t("span",{style:{color:"red"},children:"\u2718"}):null,y("span",{style:{marginRight:"5px"},children:[s+1,". "]}),t("p",{children:y("span",{className:"left-align",children:[e.question,y("span",{className:"left-align",children:[t("br",{}),t("b",{children:e.options})]})]})})]}),y("div",{style:{marginLeft:"15px"},children:[y("div",{className:"input-field col s12",children:[t("input",{title:"Enter A B C or D",onChange:u,disabled:o,value:l,id:`trial_answer${s}`,required:!0,type:"text",className:"validate",style:{color:o?v()?"green":"red":"black"}}),t("label",{htmlFor:`trial_answer${s}`,children:x?"Jibu":"Answer"})]}),t("div",{hidden:!o,className:"col s12",children:t("blockquote",{className:"green lighten-5",style:{borderLeftColor:"#00e676"},children:y("p",{id:`correct_answer_display${s}`,className:"bold",children:[x?"Jibu Sahihi: ":"Correct Answer: ",e.answer]})})}),t("div",{hidden:!o,className:"col s12",children:t("blockquote",{className:"red lighten-5",children:t("p",{id:`additional_information${s}`,className:"bold",children:e.additionalInfo})})})]})]})},ne=P.memo(({onTimeUp:e})=>{const{isMarked:s}=r.exports.useContext(R),[n,c]=r.exports.useState(+`${localStorage.getItem("remainingTime")}`||0),[d,o]=r.exports.useState(!1),l=r.exports.useMemo(()=>B(n<0?0:n),[n]);return r.exports.useEffect(()=>{if(n<=0){o(!0),s||e();return}localStorage.setItem("remainingTime",`${n>=0?n:0}`)},[n]),r.exports.useEffect(()=>{if(!d||!s){let m=setInterval(()=>{c(C=>C-1e3)},1e3);return()=>{clearInterval(m)}}},[d]),t(O,{children:t("button",{className:"waves-effect waves-light btn-small z-depth-0 white black-text",children:l})})});export{ee as C,q as N,te as O,ne as T};
