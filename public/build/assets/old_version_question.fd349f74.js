import{r as s}from"./vendor.5c57f7a1.js";import{q as M,M as P}from"./App.73a128b6.js";import{a as C,j as t,F as R}from"./index.cc430573.js";const j=({option:e,wasSelected:n,isCorrect:i,_id:p,isMarked:h,index:r,position:o,setAnswers:g,isMultiAnswersQuestion:_})=>t("div",{children:t("p",{children:C("label",{children:[t("input",{type:"checkbox",checked:n,className:"filled-in",disabled:h,onChange:m=>{g({option:e,isCorrect:i,_id:p})},required:!0,name:`sub_option_answer_${o}`}),t("span",{className:h&&i?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})})},r),O=({option:e,wasSelected:n,isCorrect:i,_id:p,isMarked:h,keyValue:r,position:o,setAnswers:g,isMultiAnswersQuestion:_})=>t("p",{children:C("label",{children:[t("input",{disabled:h,checked:n,required:!0,onChange:m=>{g({option:e,isCorrect:i,_id:p})},className:"with-gap",type:"radio",name:`sub_option_answer_${o}`}),t("span",{className:h&&i?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})},r),B=({children:e,index:n,isMarked:i,isCorrect:p})=>C("div",{style:{marginLeft:"15px",marginTop:"5px",marginBottom:"5px",display:"flex",flexDirection:"row"},children:[i?p?t("span",{style:{color:"green"},children:"\u2714"}):t("span",{style:{color:"red"},children:"\u2718"}):null,n+1,".",t("div",{children:e})]}),D=({children:e,index:n})=>t("div",{style:{marginLeft:"15px",marginTop:"5px",marginBottom:"5px"},children:e}),F=({question:e,index:n,AddInternalPaperContents:i,setAttempted:p,setCorrectAnswersCount:h,savedState:r,parentId:o})=>{const{attemptTree:g,currentPage:_,isMarked:m}=s.exports.useContext(M),[a,x]=s.exports.useState([]),[u,c]=s.exports.useState(!1),[b,A]=s.exports.useState(0);s.exports.useEffect(()=>{let l=g.pages[_].find(w=>w.content.question===o);if(!l)return;let f=l.content.children.find(w=>w.question===e._id);if(!f)return;let y=(e.options||[]).filter((w,L)=>f?f.attempted_options.findIndex(I=>I.optionID===w._id||I.optionIndex===L)>-1:!1);c(f.status),x([...a,...y])},[]),s.exports.useEffect(()=>{if(m&&a.length>0){let l=a.every(d=>d.isCorrect);c(l)}},[m,a]),s.exports.useEffect(()=>{b>0&&i({status:a.length?a.every(l=>l.isCorrect):!1,question:e._id,attempted_options:a.map(l=>({optionID:l._id,optionIndex:e.options.findIndex(d=>d._id===l._id)}))})},[b]);const v=s.exports.useMemo(()=>{var l,d;return((d=(l=e==null?void 0:e.options)==null?void 0:l.filter(f=>f.isCorrect))==null?void 0:d.length)>1},[e]),S=e.question.trim().replace(/(<([^>]+)>)/ig,"").trim().length<=1,$=l=>{if(a.length||p(1),v){let d=[...a],f=d.findIndex(y=>y._id===l._id);f>-1?d[f]=l:d.push(l),x(d)}else x([l]);A(d=>d+1)},k=S?B:D,T=(()=>{let l=v?j:O;return({position:d,index:f,option:y,isCorrect:w,_id:L,quesIndex:I,wasSelected:E})=>t(l,{_id:L,wasSelected:E,keyValue:`sub_option_${f}_${I}`,setAnswers:$,isMultiAnswersQuestion:S,position:d,option:y,index:f,isCorrect:w,isMarked:m},`sub_option_${f}_${I}`)})(),Q=l=>!!a.find(d=>d._id===l||0);return C("div",{style:{marginLeft:"6px"},children:[t("span",{dangerouslySetInnerHTML:{__html:S?"":`
                        <div style="display:flex;flex-direction:row;">
                            <p style="margin-right:5px;">
                                ${m?u?'<span style="color:green;">&#10004;</span>':'<span style="color:red;">&#10008;</span>':""}${n+1}.  
                            </p>
                            <p><strong>
                            ${e.question}
                            </strong></p>
                        </div>
                    `}}),t(k,{index:n,isMarked:m,isCorrect:u,children:e.options.map(({option:l,isCorrect:d,_id:f},y)=>T({_id:f,position:n,index:n,quesIndex:y,option:l,wasSelected:Q(f),isCorrect:d}))}),t("div",{style:{marginLeft:"15px",marginBottom:"10px"},hidden:!m,children:t("span",{dangerouslySetInnerHTML:{__html:`
                        <blockquote class="red lighten-5">
                            <span>
                                ${e.additionalInfo}
                            </span>
                        </blockquote>
                    `}})})]})},H=e=>{let n=5,i=e.length%n,p=Math.floor(e.length/n)+(i>0?1:0),h=new Array(p).fill([]);for(let r=0;r<p;r++)h[r]=e.slice(r*n,r*n+n);return h},V=(e,n,i=0)=>(p,h=!1)=>{let r=[];return p.forEach(o=>{let g=o.attempted_options[0].optionID,_=o.attempted_options[0].optionIndex,m=o.question;for(let a=0;a<n.length;a++){let x=n[a];if(x._id===m){let u=x.options.find((c,b)=>c._id===g||b===_);u&&r.push({position:a+1+i,option:u.option,isCorrect:u.isCorrect});break}}}),r.reduce((o,g)=>o.replace(new RegExp(`_{2,4}\\s?${g.position}\\s?_{2,4}`),`<span style="color:${h&&g.isCorrect?"green":"red"};"><u><b>${g.option}</b></u></span>`),e)},J=({parentId:e,position:n,sub_questions:i,setCorrectAnswersCount:p,setAttempted:h,savedChildren:r})=>{const{compSubQuestionPage:o,currentPage:g}=s.exports.useContext(M),_=s.exports.useCallback(u=>r.find(c=>c.question===u)||null,[i]);let m=s.exports.useMemo(()=>H(i||[]),[i]),a=m[o],x=m.slice(0,o).reduce((u,c)=>u+c.length,0);return t(R,{children:a.map((u,c)=>t(F,{parentId:e,question:u,savedState:_(u._id),index:c+x+n,AddInternalPaperContents:b=>{},setAttempted:h,setCorrectAnswersCount:p},c))})},W=({question:e,isMarked:n,position:i,setAttempted:p,setCorrectAnswersCount:h})=>{const{compSubQuestionPage:r,currentPage:o,attemptTree:g}=s.exports.useContext(M);console.log(e._id);const[_,m]=s.exports.useState([]),[a,x]=s.exports.useState([]),[u,c]=s.exports.useState(e.question),[b,A]=s.exports.useState(-1),v=s.exports.useMemo(()=>e.children[0].question.trim().replace(/(<([^>]+)>)/ig,"").trim().length<=1,[e]),S=v?V(e.question,e.children,i):$=>e.question;return s.exports.useEffect(()=>{_.length>0&&v&&c(S(_,n))},[_]),s.exports.useEffect(()=>{let $=document.querySelectorAll(".question-comp img");P.Materialbox.init($);let k=g.pages[o].find(T=>T.content.question===e._id);if(!k)return;let N=k.content;m(N.children),x(N.children)},[]),s.exports.useEffect(()=>{A(Math.random()),console.log(`The current sub page is ${r}`)},[o]),C("div",{children:[t("span",{dangerouslySetInnerHTML:{__html:`<div class="question-comp">${u}</div>`}}),t("div",{style:{marginTop:"5px"},children:t(J,{parentId:e._id,position:i,savedChildren:a,setAttempted:p,setCorrectAnswersCount:h,sub_questions:e.children||[]},b)})]})},U=({question:e,position:n,setAttempted:i,setCorrectAnswersCount:p,AddLibraryPaperContents:h,isMarked:r=!1})=>{const[o,g]=s.exports.useState(""),[_,m]=s.exports.useState(!1),a=c=>{const b=c.target.value;i(!o&&b?1:b?0:-1),g(c.target.value)},x=s.exports.useCallback(()=>o.toLocaleLowerCase()===e.answer.toLowerCase(),[o,e,r]),u=s.exports.useMemo(()=>e.subject.split(" ")[0].toLowerCase()==="kiswahili",[e]);return s.exports.useEffect(()=>{let c=x();m(c),p(c?1:0),h({questionType:"oldversion",content:{status:c,question:e._id,attempted_option:o}})},[r]),C("div",{className:"col s12",style:{marginBottom:"7px"},children:[C("div",{style:{display:"flex",flexDirection:"row"},children:[r?_?t("span",{style:{color:"green"},children:"\u2714"}):t("span",{style:{color:"red"},children:"\u2718"}):null,C("span",{style:{marginRight:"5px"},children:[n+1,". "]}),t("p",{children:C("span",{className:"left-align",children:[e.question,C("span",{className:"left-align",children:[t("br",{}),t("b",{children:e.options})]})]})})]}),C("div",{style:{marginLeft:"15px"},children:[C("div",{className:"input-field col s12",children:[t("input",{title:"Enter A B C or D",onChange:a,disabled:r,value:o,id:`trial_answer${n}`,required:!0,type:"text",className:"validate",style:{color:r?x()?"green":"red":"black"}}),t("label",{htmlFor:`trial_answer${n}`,children:u?"Jibu":"Answer"})]}),t("div",{hidden:!r,className:"col s12",children:t("blockquote",{className:"green lighten-5",style:{borderLeftColor:"#00e676"},children:C("p",{id:`correct_answer_display${n}`,className:"bold",children:[u?"Jibu Sahihi: ":"Correct Answer: ",e.answer]})})}),t("div",{hidden:!r,className:"col s12",children:t("blockquote",{className:"red lighten-5",children:t("p",{id:`additional_information${n}`,className:"bold",children:e.additionalInfo})})})]})]})};export{W as C,U as O,H as g};
