var F=Object.defineProperty,M=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var C=(s,a,i)=>a in s?F(s,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[a]=i,R=(s,a)=>{for(var i in a||(a={}))q.call(a,i)&&C(s,i,a[i]);if(A)for(var i of A(a))Q.call(a,i)&&C(s,i,a[i]);return s},$=(s,a)=>M(s,O(a));import{C as G,a as V,L as W,B as X,p as H,b as J,c as K,G as U,u as Y,d as x,M as Z,h as ee,S as w,e as se}from"./App.56ab7be2.js";import{R as ae,r as n}from"./vendor.fd4def91.js";import{c as te}from"./millisecondsToTime.6095074a.js";import{_ as re,j as e,L as le,a as t,F as L}from"./index.c5dd65d5.js";const ie=ae.lazy(()=>re(()=>import("./question_comp.f7aabefd.js"),["assets/question_comp.f7aabefd.js","assets/App.56ab7be2.js","assets/App.5b01b59d.css","assets/vendor.fd4def91.js","assets/index.c5dd65d5.js","assets/index.5cc787a4.css","assets/old_version_question.36f178eb.js"])),ne=({tree:s})=>(console.log(s),e(n.exports.Suspense,{fallback:e(le,{}),children:s&&e(ie,{paper:s})}));G.register(V,W,X,H,J,K);const oe=(s,a)=>({indexAxis:a?"y":"x",responsive:!0,maintainAspectRatio:!1,redraw:!0,plugins:{legend:{position:"top"},title:{display:!0,text:s},barValueSpacing:40,tooltips:{displayColors:!0,callbacks:{mode:"x"}},datalabels:{display:i=>!1},scales:{xAxes:[{gridLines:{display:!0,drawBorder:!1}}],yAxes:[{gridLines:{display:!1,drawBorder:!0}}]}}}),de=s=>{if(s.length<=1)return"First attempt";let i=s.reduce((c,p)=>[...c,p.pass-p.fail],[]),u=i.slice(Math.max(i.length-2,1)).reduce((c,p)=>p-c,0);return console.log(i),console.log(u),u===0?"No change":u<0?"Failing":"Improving"},be=({subject:s})=>{const{authToken:a}=n.exports.useContext(U);Y();const[i,u]=n.exports.useState([]),[c,p]=n.exports.useState([]),[b,T]=n.exports.useState(""),[m,D]=n.exports.useState({firstname:"",lastname:"",profilePic:"",gender:null}),[h,v]=n.exports.useState({isSpecial:!1,label:"",value:""}),[N,y]=n.exports.useState([]),[f,S]=n.exports.useState({pass:[],fail:[]}),[k,j]=n.exports.useState("First attempt"),[P,B]=n.exports.useState(0),[_,z]=n.exports.useState(0),[g,E]=n.exports.useState({questions:[],trees:[]}),I=!1;return n.exports.useEffect(()=>{const r=localStorage.getItem("classRefId")||"";x.get(`/api/grade/learners/${r}`,{headers:{Authorization:`Bearer ${a}`}}).then(({data:l})=>{if(l){u(l.learners.map(o=>({label:`${o.firstname} ${o.lastname}`,value:o._id})));return}}),Z.Tabs.init(document.querySelector(".sub-tabs"),{})},[]),n.exports.useEffect(()=>{h&&h.value&&x.get(`/api/analytics/learner/${b}/${h.value}${h.isSpecial?"/special":""}`,{headers:{Authorization:`Bearer ${a}`}}).then(({data:r})=>{if(r){let l=[...r.plottable||[]].reverse();S({pass:l.map(d=>d.score.passed),fail:l.map(d=>d.score.total-d.score.passed)}),B(r.time_per_question),j(de(l.map(d=>({pass:d.score.passed,fail:d.score.total-d.score.passed}))));let o=r.attempt_trees;E($(R({},o),{trees:[...o.trees].reverse()})),y(l);return}})},[h]),n.exports.useEffect(()=>{if(b){p([]),v(null),S({fail:[],pass:[]}),y([]);const r=localStorage.getItem("classId")||"";x.get(`/api/analytics/subject/${r}/${b}/${s}`,{headers:{Authorization:`Bearer ${a}`}}).then(({data:l})=>{if(l){D(l.student),p(l.papersDone.map(o=>({label:`${s} ( ${o.subject} )`,value:o.paperID,isSpecial:o.isSpecial})));return}})}},[b]),t("div",{className:"row",children:[m.firstname?e("div",{className:"col s12 center",children:t("div",{style:{margin:"auto"},children:[e("img",{style:{height:"100px",width:"100px",objectFit:"contain",border:"1px solid #d3d3d3",borderRadius:"50%"},src:m.profilePic?m.profilePic:ee(m.gender)}),e("br",{}),e("span",{className:"sub-modal-texts",style:{letterSpacing:"1px"},children:t("b",{children:[m.firstname," ",m.lastname]})}),c.length?null:t(L,{children:[" ",e("span",{className:"sub-modal-texts",style:{border:"1px solid red",padding:"1px 10px",borderRadius:"20px"},children:e("b",{children:"has not attempted any paper(s)"})})]})]})}):null,e("div",{className:"col s12",children:t("ul",{className:"sub-tabs tabs tabs-fixed-width",style:{overflowX:"hidden"},children:[e("li",{className:"tab col s6",children:e("a",{href:"#analytics",className:"active",children:"Analytics"})}),e("li",{className:`tab col s6 ${g.trees.length?"":"disabled"}`,children:t("a",{href:"#lastDonePapers",children:["Last (",N.length,") Paper(s)"]})})]})}),t("div",{id:"analytics",children:[e("div",{className:"col s12 m12 l4",children:e("div",{className:"card z-depth-0",style:{border:"1px solid #dcdee2"},children:t("div",{className:"card-content",children:[t("div",{className:"row",children:[t("div",{className:"col s12 m12",children:[e("label",{children:"Learner"}),e(w,{hideSelectedOptions:!0,onChange:r=>{T((r==null?void 0:r.value)||"")},options:i,placeholder:"select learner..."})]}),t("div",{className:"col s12 m12",children:[e("label",{children:"Paper"}),e(w,{hideSelectedOptions:!0,isDisabled:!b||!c.length,options:c,value:h,onChange:r=>{v(r||{})},placeholder:"select paper..."})]})]}),e("div",{className:"row",id:"performanceReportButton",hidden:!0,children:e("div",{className:"col s12 m12",children:t("button",{onClick:()=>{},"data-position":"bottom","data-tooltip":"Scroll down to view or download the report",className:"btn-small sub-modal-texts tooltipped white black-text waves-effect waves-black z-depth-1",style:{width:"100%",fontWeight:"bold"},children:["PERFORMANCE REPORT",e("i",{className:"material-icons right",children:"assessment"})]})})})]})})}),t("div",{className:"col s12 m12 l8",children:[N.length?e("div",{className:"card z-depth-0",style:{border:"1px solid #dcdee2"},children:t("div",{className:"card-content sub-modal-texts center",children:["Remarks: ",e("span",{style:{border:"1px solid green",padding:"1px 2px",borderRadius:"2px"},children:e("b",{children:k})}),P>0?t(L,{children:[" ",e("b",{children:"|"})," ","Av. Time Per Question: ",e("span",{style:{border:"1px solid green",padding:"1px 2px",borderRadius:"2px"},children:e("b",{children:te(P,!0)})})]}):null]})}):null,e("div",{className:"card z-depth-0",style:{border:"1px solid #dcdee2"},children:e("div",{className:"card-content",children:e("div",{className:"row",id:"insertChart",children:e(se,{options:oe("Performance Analysis",I),style:{height:"300px"},data:{labels:f.pass.map((r,l)=>`Attempt ${l+1}`),datasets:[{label:"Pass",data:f.pass,backgroundColor:"#00c853"},{label:"Fail",data:f.fail,backgroundColor:"#f44336"}]}})})})})]})]}),e("div",{id:"lastDonePapers",children:g.trees.length?e("div",{className:"col s12 m12",children:t("div",{className:"section",children:[t("div",{className:"col s12",children:[g.trees.map((r,l)=>e("button",{className:`btn-flat sub-modal-texts ${_===l?"teal lighten-5":""}`,style:{border:"1px solid #d3d3d3",borderTop:"2px solid #80cbc4",borderRadius:"5px 5px 0px 0px",marginRight:"1px"},onClick:o=>{z(l)},children:t("b",{children:["Attempt ",l+1," ",t("span",{className:"red-text sub-names",children:["( ",r.score.passed," / ",r.score.total,")"]})]})},`attempt_pill_${l}`)),e("div",{className:"divider",style:{marginBottom:"5px"}})]}),e("div",{className:"col s12",children:e(ne,{tree:g.trees[_]})})]})}):null})]})};export{be as default,oe as options};
