import{C as j,a as D,L as T,B as k,p as B,b as I,c as E,G as F,u as z,d as f,M,h as O,S as P,e as G}from"./App.b5b0e2d2.js";import{r as l}from"./vendor.fd4def91.js";import{c as Q}from"./millisecondsToTime.25c67ebb.js";import{a as t,j as e,F as $}from"./index.d9930741.js";j.register(D,T,k,B,I,E);const q=(n,d)=>({indexAxis:d?"y":"x",responsive:!0,maintainAspectRatio:!1,redraw:!0,plugins:{legend:{position:"top"},title:{display:!0,text:n},barValueSpacing:40,tooltips:{displayColors:!0,callbacks:{mode:"x"}},datalabels:{display:h=>!1},scales:{xAxes:[{gridLines:{display:!0,drawBorder:!1}}],yAxes:[{gridLines:{display:!1,drawBorder:!0}}]}}}),V=n=>{if(n.length<=1)return"First attempt";let h=n.reduce((u,i)=>[...u,i.pass-i.fail],[]),m=h.slice(Math.max(h.length-2,1)).reduce((u,i)=>i-u,0);return console.log(m),m===0?"No change":m<0?"Failing":"Improving"},K=({subject:n})=>{const{authToken:d}=l.exports.useContext(F),h=z(),[m,u]=l.exports.useState([]),[i,x]=l.exports.useState([]),[o,w]=l.exports.useState(""),[c,C]=l.exports.useState({firstname:"",lastname:"",profilePic:"",gender:null}),[p,v]=l.exports.useState({isSpecial:!1,label:"",value:""}),[b,N]=l.exports.useState([]),[g,y]=l.exports.useState({pass:[],fail:[]}),[A,_]=l.exports.useState("First attempt"),[S,L]=l.exports.useState(0),R=!1;return l.exports.useEffect(()=>{const s=localStorage.getItem("classRefId")||"";f.get(`/api/grade/learners/${s}`,{headers:{Authorization:`Bearer ${d}`}}).then(({data:r})=>{if(r){u(r.learners.map(a=>({label:`${a.firstname} ${a.lastname}`,value:a._id})));return}}),M.Tabs.init(document.querySelector(".sub-tabs"),{swipeable:!0})},[]),l.exports.useEffect(()=>{p&&p.value&&f.get(`/api/analytics/learner/${o}/${p.value}${p.isSpecial?"/special":""}`,{headers:{Authorization:`Bearer ${d}`}}).then(({data:s})=>{if(s){let r=[...s.plottable||[]].reverse();y({pass:r.map(a=>a.score.passed),fail:r.map(a=>a.score.total-a.score.passed)}),L(s.time_per_question),_(V(r.map(a=>({pass:a.score.passed,fail:a.score.total-a.score.passed})))),N(r);return}})},[p]),l.exports.useEffect(()=>{if(o){x([]),v(null),y({fail:[],pass:[]}),N([]);const s=localStorage.getItem("classId")||"";f.get(`/api/analytics/subject/${s}/${o}/${n}`,{headers:{Authorization:`Bearer ${d}`}}).then(({data:r})=>{if(r){C(r.student),x(r.papersDone.map(a=>({label:`${n} ( ${a.subject} )`,value:a.paperID,isSpecial:a.isSpecial})));return}})}},[o]),t("div",{className:"row",children:[c.firstname?e("div",{className:"col s12 center",children:t("div",{style:{margin:"auto"},children:[e("img",{style:{height:"100px",width:"100px",objectFit:"contain",border:"1px solid #d3d3d3",borderRadius:"50%"},src:c.profilePic?c.profilePic:O(c.gender)}),e("br",{}),e("span",{className:"sub-modal-texts",style:{letterSpacing:"1px"},children:t("b",{children:[c.firstname," ",c.lastname]})}),i.length?null:t($,{children:[" ",e("span",{className:"sub-modal-texts",style:{border:"1px solid red",padding:"1px 10px",borderRadius:"20px"},children:e("b",{children:"has not attempted any paper(s)"})})]})]})}):null,e("div",{className:"col s12",children:t("ul",{className:"sub-tabs tabs tabs-fixed-width",style:{overflowX:"hidden"},children:[e("li",{className:"tab col s6",children:e("a",{href:"#analytics",className:"active",children:"Analytics"})}),e("li",{className:`tab col s6 ${b.length?"":"disabled"}`,children:t("a",{href:"#lastDonePapers",children:["Last (",b.length,") Paper(s)"]})})]})}),t("div",{id:"analytics",children:[e("div",{className:"col s12 m12 l4",children:e("div",{className:"card z-depth-0",style:{border:"1px solid #dcdee2"},children:t("div",{className:"card-content",children:[t("div",{className:"row",children:[t("div",{className:"col s12 m12",children:[e("label",{children:"Learner"}),e(P,{hideSelectedOptions:!0,onChange:s=>{w((s==null?void 0:s.value)||"")},options:m,placeholder:"select learner..."})]}),t("div",{className:"col s12 m12",children:[e("label",{children:"Paper"}),e(P,{hideSelectedOptions:!0,isDisabled:!o||!i.length,options:i,value:p,onChange:s=>{v(s||{})},placeholder:"select paper..."})]})]}),e("div",{className:"row",id:"performanceReportButton",hidden:!0,children:e("div",{className:"col s12 m12",children:t("button",{onClick:()=>{},"data-position":"bottom","data-tooltip":"Scroll down to view or download the report",className:"btn-small sub-modal-texts tooltipped white black-text waves-effect waves-black z-depth-1",style:{width:"100%",fontWeight:"bold"},children:["PERFORMANCE REPORT",e("i",{className:"material-icons right",children:"assessment"})]})})})]})})}),t("div",{className:"col s12 m12 l8",children:[b.length?e("div",{className:"card z-depth-0",style:{border:"1px solid #dcdee2"},children:t("div",{className:"card-content sub-modal-texts center",children:[S>0?t($,{children:["Average Time Per Question: ",e("span",{style:{border:"1px solid green",padding:"1px 2px",borderRadius:"2px"},children:e("b",{children:Q(S)})})," ",e("b",{children:"|"})," "]}):null,"General comment: ",e("span",{style:{border:"1px solid green",padding:"1px 2px",borderRadius:"2px"},children:e("b",{children:A})})]})}):null,e("div",{className:"card z-depth-0",style:{border:"1px solid #dcdee2"},children:e("div",{className:"card-content",children:e("div",{className:"row",id:"insertChart",children:e(G,{options:q("Performance Analysis",R),style:{height:"300px"},data:{labels:g.pass.map((s,r)=>`Attempt ${r+1}`),datasets:[{label:"Pass",data:g.pass,backgroundColor:"#00c853"},{label:"Fail",data:g.fail,backgroundColor:"#f44336"}]}})})})})]})]}),e("div",{id:"lastDonePapers",children:b.length?e("div",{className:"col s12 m12",children:e("div",{className:"section",children:b.map((s,r)=>e("div",{className:"col s6 m2 l2",children:e("div",{className:"hoverable",onClick:a=>h(s.isSpecial?`/library-paper/special/${o}/${s.grade}/${s.paperID}/${s._id}`:`/library-paper/${o}/${s._id}`),style:{backgroundColor:"#fffde7",marginBottom:"5px",cursor:"pointer",border:"1px solid #d3d3d3",borderRadius:"2px",padding:"4px"},children:t("div",{className:"center",children:[e("span",{className:"sub-names truncate",children:e("b",{children:s.subject})}),e("br",{}),e("span",{className:"sub-modal-texts teal-text truncate",style:{backgroundColor:"#fff",border:"1px solid #d3d3d3",padding:"4px",borderRadius:"2px"},children:t("b",{children:[s.subject.split(" ")[0].toLocaleLowerCase().includes("kiwahili")?"ALAMA":"SCORE","(",s.score.passed,"/",s.score.total,")"]})})]})})},r))})}):null})]})};export{K as default,q as options};
