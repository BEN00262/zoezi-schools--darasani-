var K=Object.defineProperty,W=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var I=(l,s,t)=>s in l?K(l,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[s]=t,L=(l,s)=>{for(var t in s||(s={}))J.call(s,t)&&I(l,t,s[t]);if(k)for(var t of k(s))P.call(s,t)&&I(l,t,s[t]);return l},q=(l,s)=>W(l,X(s));import{j as E,k as U,l as Y,m as Z,n as ee,o as se,q as te,r as ae,C as le,a as re,L as ne,B as ie,p as oe,b as ce,c as de,G as pe,u as ue,d as $,M as me,h as he,S as M,e as be}from"./App.da620e27.js";import{R as z,r as a}from"./vendor.5c57f7a1.js";import{c as ge}from"./millisecondsToTime.6095074a.js";import{_ as B,j as e,L as Q,F as j,a as i}from"./index.2be7657d.js";const xe=z.lazy(()=>B(()=>import("./question_comp.c049e833.js"),["assets/question_comp.c049e833.js","assets/App.da620e27.js","assets/App.bede793c.css","assets/vendor.5c57f7a1.js","assets/index.2be7657d.js","assets/index.5cc787a4.css","assets/old_version_question.14d671fd.js"])),fe=({tree:l})=>(console.log(l),e(a.exports.Suspense,{fallback:e(Q,{}),children:l&&e(xe,{paper:l})})),_e=z.lazy(()=>B(()=>import("./question_comp.c93bab58.js"),["assets/question_comp.c93bab58.js","assets/vendor.5c57f7a1.js","assets/App.da620e27.js","assets/App.bede793c.css","assets/index.2be7657d.js","assets/index.5cc787a4.css","assets/TimerComp.c06f0b52.js","assets/millisecondsToTime.6095074a.js"]));function ye({wasTimed:l,setCurrentlySavedPageNumber:s}){const{subject:t,currentPage:d,updateNoQuesPerPage:p,questions:u,paperMap:m}=a.exports.useContext(E),[N,x]=a.exports.useState([]),[f,h]=a.exports.useState(0),[y,C]=a.exports.useState(-1),_=a.exports.useMemo(()=>t.split(" ")[0].toLowerCase()==="kiswahili",[t]);return a.exports.useEffect(()=>{h(U(u,m,d));let b=m.pages[d];p(b.endIndex-b.startIndex),x(u.slice(b.startIndex,b.endIndex)),C(Math.random()),s(d)},[d]),e(j,{children:e(a.exports.Suspense,{fallback:e(Y.Container,{children:_?"Karatasi inatayarishwa ...":"Preparing paper ..."}),children:e(_e,{questions:N,alreadyDone:f,isKiswahili:_,wasTimed:l})},y)})}const Se=({gradeName:l,prePaper:s,prePrevState:t,currentlySavedPageNumber:d,setCurrentlySavedPageNumber:p,currentlySavedSubPageNumber:u})=>{const{updateQuestions:m,setSubjectName:N,attemptTree:x}=a.exports.useContext(E),[f,h]=a.exports.useState(),[y,C]=a.exports.useState(!1),[_,b]=a.exports.useState(-1);return a.exports.useEffect(()=>{var T,R,v,w,n;h(s),N((s==null?void 0:s.subject)||"");const S=se((s==null?void 0:s.questions)||[]),D=te((s==null?void 0:s.questions)||[]);let A=d>-1?d:t.currentPage||0;m({questions:(s==null?void 0:s.questions)||[],paperMap:S,gradeName:l,paperID:"paperid_something",isLibraryPaper:!0,paperHistoryID:t._id||"",currentPage:A,compSubQuestionPage:t.compSubQuestionPage||0,isMarked:t.isMarked||!1,isTimed:t.isTimed||(f==null?void 0:f.isTimed)||!1,remainingTime:t.remainingTime||1e4,numOfQuestions:D,totalPages:Object.keys(S.pages).length,attemptTree:{subject:(s==null?void 0:s.subject)||"",score:{passed:((R=(T=t==null?void 0:t.attemptTree)==null?void 0:T.score)==null?void 0:R.passed)||0,total:((w=(v=t==null?void 0:t.attemptTree)==null?void 0:v.score)==null?void 0:w.total)||D},pages:((n=t==null?void 0:t.attemptTree)==null?void 0:n.pages)||ae(S,(s==null?void 0:s.questions)||[])}}),C(!0),b(Math.random())},[t]),f?y?e(ye,{wasTimed:!1,setCurrentlySavedPageNumber:p},_):null:e(Q,{})},ve=l=>e(Z,{children:e(ee,{children:e(Se,L({},l))})});le.register(re,ne,ie,oe,ce,de);const Ne=(l,s)=>({indexAxis:s?"y":"x",responsive:!0,maintainAspectRatio:!1,redraw:!0,plugins:{legend:{position:"top"},title:{display:!0,text:l},barValueSpacing:40,tooltips:{displayColors:!0,callbacks:{mode:"x"}},datalabels:{display:t=>!1},scales:{xAxes:[{gridLines:{display:!0,drawBorder:!1}}],yAxes:[{gridLines:{display:!1,drawBorder:!0}}]}}}),Ce=l=>{if(l.length<=1)return"First attempt";let t=l.reduce((p,u)=>[...p,u.pass-u.fail],[]),d=(t.length>2?t.slice(Math.max(t.length-2,1)):t).reduce((p,u)=>u-p,0);return d===0?"No change":d<0?"Declining":"Improving"},je=({subject:l})=>{const{authToken:s}=a.exports.useContext(pe);ue();const[t,d]=a.exports.useState([]),[p,u]=a.exports.useState([]),[m,N]=a.exports.useState(""),[x,f]=a.exports.useState({firstname:"",lastname:"",profilePic:"",gender:null}),[h,y]=a.exports.useState({isSpecial:!1,label:"",value:""}),[C,_]=a.exports.useState([]),[b,S]=a.exports.useState({pass:[],fail:[]}),[D,A]=a.exports.useState("First attempt"),[T,R]=a.exports.useState(0),[v,w]=a.exports.useState(0),[n,O]=a.exports.useState({isSpecial:!1,paper:{},trees:[],prevStates:[]}),[F,G]=a.exports.useState(-1),[V,Te]=a.exports.useState(-1),H=!1;return a.exports.useEffect(()=>{const r=localStorage.getItem("classRefId")||"";$.get(`/api/grade/learners/${r}`,{headers:{Authorization:`Bearer ${s}`}}).then(({data:o})=>{if(o){d(o.learners.map(c=>({label:`${c.firstname} ${c.lastname}`,value:c._id})));return}}),me.Tabs.init(document.querySelector(".sub-tabs"),{})},[]),a.exports.useEffect(()=>{h&&h.value&&$.get(`/api/analytics/learner/${m}/${h.value}${h.isSpecial?"/special":""}`,{headers:{Authorization:`Bearer ${s}`}}).then(({data:r})=>{if(r){let o=[...r.plottable||[]].reverse();S({pass:o.map(g=>g.score.passed),fail:o.map(g=>g.score.total-g.score.passed)}),R(r.time_per_question),A(Ce(o.map(g=>({pass:g.score.passed,fail:g.score.total-g.score.passed}))));let c=r.attempt_trees;O(q(L({},c),{trees:[...c.trees].reverse(),prevStates:[...c.prevStates].reverse()})),_(o);return}})},[h]),a.exports.useEffect(()=>{if(m){u([]),y(null),S({fail:[],pass:[]}),_([]);const r=localStorage.getItem("classId")||"";$.get(`/api/analytics/subject/${r}/${m}/${l}`,{headers:{Authorization:`Bearer ${s}`}}).then(({data:o})=>{if(o){f(o.student),u(o.papersDone.map(c=>({label:`${l} ( ${c.subject} )`,value:c.paperID,isSpecial:c.isSpecial})));return}})}},[m]),i("div",{className:"row",children:[x.firstname?e("div",{className:"col s12 center",children:i("div",{style:{margin:"auto"},children:[e("img",{style:{height:"100px",width:"100px",objectFit:"contain",border:"1px solid #d3d3d3",borderRadius:"50%"},src:x.profilePic?x.profilePic:he(x.gender)}),e("br",{}),e("span",{className:"sub-modal-texts",style:{letterSpacing:"1px"},children:i("b",{children:[x.firstname," ",x.lastname]})}),p.length?null:i(j,{children:[" ",e("span",{className:"sub-modal-texts",style:{border:"1px solid red",padding:"1px 10px",borderRadius:"20px"},children:e("b",{children:"has not attempted any paper(s)"})})]})]})}):null,e("div",{className:"col s12",children:i("ul",{className:"sub-tabs tabs tabs-fixed-width",style:{overflowX:"hidden"},children:[e("li",{className:"tab col s6",children:e("a",{href:"#analytics",className:"active",children:"Analytics"})}),e("li",{className:`tab col s6 ${n.trees.length||n.prevStates.length?"":"disabled"}`,children:i("a",{href:"#lastDonePapers",children:["Last (",n.trees.length||n.prevStates.length,") Paper(s)"]})})]})}),i("div",{id:"analytics",children:[e("div",{className:"col s12 m12 l4",children:e("div",{className:"card z-depth-0",style:{border:"1px solid #dcdee2"},children:i("div",{className:"card-content",children:[i("div",{className:"row",children:[i("div",{className:"col s12 m12",children:[e("label",{children:"Learner"}),e(M,{hideSelectedOptions:!0,onChange:r=>{N((r==null?void 0:r.value)||"")},options:t,placeholder:"select learner..."})]}),i("div",{className:"col s12 m12",children:[e("label",{children:"Paper"}),e(M,{hideSelectedOptions:!0,isDisabled:!m||!p.length,options:p,value:h,onChange:r=>{y(r||{})},placeholder:"select paper..."})]})]}),e("div",{className:"row",id:"performanceReportButton",hidden:!0,children:e("div",{className:"col s12 m12",children:i("button",{onClick:()=>{},"data-position":"bottom","data-tooltip":"Scroll down to view or download the report",className:"btn-small sub-modal-texts tooltipped white black-text waves-effect waves-black z-depth-1",style:{width:"100%",fontWeight:"bold"},children:["PERFORMANCE REPORT",e("i",{className:"material-icons right",children:"assessment"})]})})})]})})}),i("div",{className:"col s12 m12 l8",children:[C.length?e("div",{className:"card z-depth-0",style:{border:"1px solid #dcdee2"},children:i("div",{className:"card-content sub-modal-texts center",children:["Remarks: ",e("span",{style:{border:"1px solid green",padding:"1px 2px",borderRadius:"2px"},children:e("b",{children:D})}),T>0?i(j,{children:[" ",e("b",{children:"|"})," ","Av. Time Per Question: ",e("span",{style:{border:"1px solid green",padding:"1px 2px",borderRadius:"2px"},children:e("b",{children:ge(T,!0)})})]}):null]})}):null,e("div",{className:"card z-depth-0",style:{border:"1px solid #dcdee2"},children:e("div",{className:"card-content",children:e("div",{className:"row",id:"insertChart",children:e(be,{options:Ne("Performance Analysis",H),style:{height:"300px"},data:{labels:b.pass.map((r,o)=>`Attempt ${o+1}`),datasets:[{label:"Pass",data:b.pass,backgroundColor:"#00c853"},{label:"Fail",data:b.fail,backgroundColor:"#f44336"}]}})})})})]})]}),e("div",{id:"lastDonePapers",children:(n.isSpecial?n.prevStates.length:n.trees.length)?e("div",{className:"col s12 m12",children:i("div",{className:"section",children:[i("div",{className:"col s12",children:[(n.isSpecial?n.prevStates:n.trees).map((r,o)=>{let c=n.isSpecial?r.attemptTree.score.passed:r.score.passed,g=n.isSpecial?r.attemptTree.score.total:r.score.total;return e("button",{className:`btn-flat sub-modal-texts ${v===o?"teal lighten-5":""}`,style:{border:"1px solid #d3d3d3",borderTop:"2px solid #80cbc4",borderRadius:"5px 5px 0px 0px",marginRight:"1px"},onClick:De=>{w(o)},children:i("b",{children:["Attempt ",o+1," ",i("span",{className:"red-text sub-names",children:["( ",c," / ",g,")"]})]})},`attempt_pill_${o}`)}),e("div",{className:"divider",style:{marginBottom:"5px"}})]}),e("div",{className:"col s12",children:n.isSpecial?e(ve,{currentlySavedPageNumber:F,setCurrentlySavedPageNumber:G,currentlySavedSubPageNumber:V,gradeName:"Sample Grade",prePaper:n.paper,prePrevState:n.prevStates[v]}):e(fe,{tree:n.trees[v]})})]})}):null})]})};export{je as default,Ne as options};
