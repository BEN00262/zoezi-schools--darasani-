var W=Object.defineProperty,X=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var I=(l,s,t)=>s in l?W(l,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[s]=t,k=(l,s)=>{for(var t in s||(s={}))J.call(s,t)&&I(l,t,s[t]);if($)for(var t of $(s))U.call(s,t)&&I(l,t,s[t]);return l},q=(l,s)=>X(l,Z(s));import{q as E,G as z,r as Y,l as ee,s as se,v as te,w as ae,R as M,x as le,y as re,z as ne,C as ie,a as oe,L as ce,B as de,p as ue,b as pe,c as me,A as Q,u as he,f as be,d as L,M as ge,j as xe,S as B,e as fe}from"./App.fdb277d2.js";import{R as O,r as a}from"./vendor.497bb12a.js";import{c as _e}from"./millisecondsToTime.26b2335e.js";import{_ as F,j as e,L as G,F as j,a as n}from"./index.d3bdb59a.js";const Se=O.lazy(()=>F(()=>import("./question_comp.eb78d1de.js"),["assets/question_comp.eb78d1de.js","assets/App.fdb277d2.js","assets/App.bede793c.css","assets/vendor.497bb12a.js","assets/index.d3bdb59a.js","assets/index.5cc787a4.css","assets/old_version_question.1891a34f.js"])),ye=({tree:l})=>(console.log(l),e(a.exports.Suspense,{fallback:e(G,{}),children:l&&e(Se,{paper:l})})),ve=O.lazy(()=>F(()=>import("./question_comp.c27f1a51.js"),["assets/question_comp.c27f1a51.js","assets/vendor.497bb12a.js","assets/App.fdb277d2.js","assets/App.bede793c.css","assets/index.d3bdb59a.js","assets/index.5cc787a4.css","assets/TimerComp.f212edf3.js","assets/millisecondsToTime.26b2335e.js","assets/old_version_question.c53cf162.js"]));function Ne({wasTimed:l}){const s=E(P),t=E(V),{subject:m,currentPage:c,compSubQuestionPage:u,updateNoQuesPerPage:g,questions:x,paperMap:p}=a.exports.useContext(z),[T,h]=a.exports.useState([]),[v,C]=a.exports.useState(0),[f,_]=a.exports.useState(-1),y=a.exports.useMemo(()=>m.split(" ")[0].toLowerCase()==="kiswahili",[m]);return a.exports.useEffect(()=>{C(Y(x,p,c));const S=p.pages[c];g(S.endIndex-S.startIndex),h(x.slice(S.startIndex,S.endIndex)),_(Math.random()),s(c)},[c]),a.exports.useEffect(()=>{t(u)},[u]),e(j,{children:e(a.exports.Suspense,{fallback:e(ee.Container,{children:y?"Karatasi inatayarishwa ...":"Preparing paper ..."}),children:e(ve,{questions:T,alreadyDone:v,isKiswahili:y,wasTimed:l})},f)})}const Te=({gradeName:l,prePaper:s,prePrevState:t})=>{const m=M(P),c=M(V),{updateQuestions:u,setSubjectName:g}=a.exports.useContext(z),[x,p]=a.exports.useState(),[T,h]=a.exports.useState(!1),[v,C]=a.exports.useState(-1);return a.exports.useEffect(()=>{var D,R,w,N,A;p(s),g((s==null?void 0:s.subject)||"");const f=le((s==null?void 0:s.questions)||[]),_=re((s==null?void 0:s.questions)||[]),y=m>-1?m:t.currentPage||0,S=c>-1?c:t.compSubQuestionPage||0;u({questions:(s==null?void 0:s.questions)||[],paperMap:f,gradeName:l,paperID:"paperid_something",isLibraryPaper:!0,paperHistoryID:t._id||"",currentPage:y,compSubQuestionPage:S,isMarked:t.isMarked||!1,isTimed:t.isTimed||(x==null?void 0:x.isTimed)||!1,remainingTime:t.remainingTime||1e4,numOfQuestions:_,totalPages:Object.keys(f.pages).length,attemptTree:{subject:(s==null?void 0:s.subject)||"",score:{passed:((R=(D=t==null?void 0:t.attemptTree)==null?void 0:D.score)==null?void 0:R.passed)||0,total:((N=(w=t==null?void 0:t.attemptTree)==null?void 0:w.score)==null?void 0:N.total)||_},pages:((A=t==null?void 0:t.attemptTree)==null?void 0:A.pages)||ne(f,(s==null?void 0:s.questions)||[])}}),h(!0),C(Math.random())},[t]),x?T?e(Ne,{wasTimed:!1},v):null:e(G,{})},Ce=l=>e(se,{children:e(te,{children:e(ae,{children:e(Te,k({},l))})})});ie.register(oe,ce,de,ue,pe,me);const Re=(l,s)=>({indexAxis:s?"y":"x",responsive:!0,maintainAspectRatio:!1,redraw:!0,plugins:{legend:{position:"top"},title:{display:!0,text:l},barValueSpacing:40,tooltips:{displayColors:!0,callbacks:{mode:"x"}},datalabels:{display:t=>!1},scales:{xAxes:[{gridLines:{display:!0,drawBorder:!1}}],yAxes:[{gridLines:{display:!1,drawBorder:!0}}]}}}),De=l=>{if(l.length<=1)return"First attempt";const t=l.reduce((c,u)=>[...c,u.pass-u.fail],[]),m=(t.length>2?t.slice(Math.max(t.length-2,1)):t).reduce((c,u)=>u-c,0);return m===0?"No change":m<0?"Declining":"Improving"},P=Q({key:"currentlySavedPageNumberId",default:-1}),V=Q({key:"currentlySavedSubPageNumberId",default:-1}),Ie=({subject:l})=>{const{authToken:s}=he();be();const[t,m]=a.exports.useState([]),[c,u]=a.exports.useState([]),[g,x]=a.exports.useState(""),[p,T]=a.exports.useState({firstname:"",lastname:"",profilePic:"",gender:null}),[h,v]=a.exports.useState({isSpecial:!1,label:"",value:""}),[C,f]=a.exports.useState([]),[_,y]=a.exports.useState({pass:[],fail:[]}),[S,D]=a.exports.useState("First attempt"),[R,w]=a.exports.useState(0),[N,A]=a.exports.useState(0),[o,H]=a.exports.useState({isSpecial:!1,paper:{},trees:[],prevStates:[]}),K=!1;return a.exports.useEffect(()=>{const r=localStorage.getItem("classRefId")||"";L.get(`/api/grade/learners/${r}`,{headers:{Authorization:`Bearer ${s}`}}).then(({data:i})=>{if(i){m(i.learners.map(d=>({label:`${d.firstname} ${d.lastname}`,value:d._id})));return}}),ge.Tabs.init(document.querySelector(".sub-tabs"),{})},[]),a.exports.useEffect(()=>{h&&h.value&&L.get(`/api/analytics/learner/${g}/${h.value}${h.isSpecial?"/special":""}`,{headers:{Authorization:`Bearer ${s}`}}).then(({data:r})=>{if(r){const i=[...r.plottable||[]].reverse();y({pass:i.map(b=>b.score.passed),fail:i.map(b=>b.score.total-b.score.passed)}),w(r.time_per_question),D(De(i.map(b=>({pass:b.score.passed,fail:b.score.total-b.score.passed}))));const d=r.attempt_trees;H(q(k({},d),{trees:[...d.trees].reverse(),prevStates:[...d.prevStates].reverse()})),f(i);return}})},[h]),a.exports.useEffect(()=>{if(g){u([]),v(null),y({fail:[],pass:[]}),f([]);const r=localStorage.getItem("classId")||"";L.get(`/api/analytics/subject/${r}/${g}/${l}`,{headers:{Authorization:`Bearer ${s}`}}).then(({data:i})=>{if(i){T(i.student),u(i.papersDone.map(d=>({label:`${l} ( ${d.subject} )`,value:d.paperID,isSpecial:d.isSpecial})));return}})}},[g]),n("div",{className:"row",children:[p.firstname?e("div",{className:"col s12 center",children:n("div",{style:{margin:"auto"},children:[e("img",{style:{height:"100px",width:"100px",objectFit:"contain",border:"1px solid #d3d3d3",borderRadius:"50%"},src:p.profilePic?p.profilePic:xe(p.gender)}),e("br",{}),e("span",{className:"sub-modal-texts",style:{letterSpacing:"1px"},children:n("b",{children:[p.firstname," ",p.lastname]})}),c.length?null:n(j,{children:[" ",e("span",{className:"sub-modal-texts",style:{border:"1px solid red",padding:"1px 10px",borderRadius:"20px"},children:e("b",{children:"has not attempted any paper(s)"})})]})]})}):null,e("div",{className:"col s12",children:n("ul",{className:"sub-tabs tabs tabs-fixed-width",style:{overflowX:"hidden"},children:[e("li",{className:"tab col s6",children:e("a",{href:"#analytics",className:"active",children:"Analytics"})}),e("li",{className:`tab col s6 ${o.trees.length||o.prevStates.length?"":"disabled"}`,children:n("a",{href:"#lastDonePapers",children:["Last (",o.trees.length||o.prevStates.length,") Paper(s)"]})})]})}),n("div",{id:"analytics",children:[e("div",{className:"col s12 m12 l4",children:e("div",{className:"card z-depth-0",style:{border:"1px solid #dcdee2"},children:n("div",{className:"card-content",children:[n("div",{className:"row",children:[n("div",{className:"col s12 m12",children:[e("label",{children:"Learner"}),e(B,{hideSelectedOptions:!0,onChange:r=>{x((r==null?void 0:r.value)||"")},options:t,placeholder:"select learner..."})]}),n("div",{className:"col s12 m12",children:[e("label",{children:"Paper"}),e(B,{hideSelectedOptions:!0,isDisabled:!g||!c.length,options:c,value:h,onChange:r=>{v(r||{})},placeholder:"select paper..."})]})]}),e("div",{className:"row",id:"performanceReportButton",hidden:!0,children:e("div",{className:"col s12 m12",children:n("button",{onClick:()=>{},"data-position":"bottom","data-tooltip":"Scroll down to view or download the report",className:"btn-small sub-modal-texts tooltipped white black-text waves-effect waves-black z-depth-1",style:{width:"100%",fontWeight:"bold"},children:["PERFORMANCE REPORT",e("i",{className:"material-icons right",children:"assessment"})]})})})]})})}),n("div",{className:"col s12 m12 l8",children:[C.length?e("div",{className:"card z-depth-0",style:{border:"1px solid #dcdee2"},children:n("div",{className:"card-content sub-modal-texts center",children:["Remarks: ",e("span",{style:{border:"1px solid green",padding:"1px 2px",borderRadius:"2px"},children:e("b",{children:S})}),R>0?n(j,{children:[" ",e("b",{children:"|"})," ","Av. Time Per Question: ",e("span",{style:{border:"1px solid green",padding:"1px 2px",borderRadius:"2px"},children:e("b",{children:_e(R,!0)})})]}):null]})}):null,e("div",{className:"card z-depth-0",style:{border:"1px solid #dcdee2"},children:e("div",{className:"card-content",children:e("div",{className:"row",id:"insertChart",children:e(fe,{options:Re("Performance Analysis",K),style:{height:"300px"},data:{labels:_.pass.map((r,i)=>`Attempt ${i+1}`),datasets:[{label:"Pass",data:_.pass,backgroundColor:"#00c853"},{label:"Fail",data:_.fail,backgroundColor:"#f44336"}]}})})})})]})]}),e("div",{id:"lastDonePapers",children:(o.isSpecial?o.prevStates.length:o.trees.length)?e("div",{className:"col s12 m12",children:n("div",{className:"section",children:[n("div",{className:"col s12",children:[(o.isSpecial?o.prevStates:o.trees).map((r,i)=>{const d=o.isSpecial?r.attemptTree.score.passed:r.score.passed,b=o.isSpecial?r.attemptTree.score.total:r.score.total;return e("button",{className:`btn-flat sub-modal-texts ${N===i?"teal lighten-5":""}`,style:{border:"1px solid #d3d3d3",borderTop:"2px solid #80cbc4",borderRadius:"5px 5px 0px 0px",marginRight:"1px"},onClick:we=>{A(i)},children:n("b",{children:["Attempt ",i+1," ",n("span",{className:"red-text sub-names",children:["( ",d," / ",b,")"]})]})},`attempt_pill_${i}`)}),e("div",{className:"divider",style:{marginBottom:"5px"}})]}),e("div",{className:"col s12",children:o.isSpecial?e(Ce,{gradeName:"Sample Grade",prePaper:o.paper,prePrevState:o.prevStates[N]}):e(ye,{tree:o.trees[N]})})]})}):null})]})};export{P as currentlySavedPageNumberState,V as currentlySavedSubPageNumberState,Ie as default,Re as options};
