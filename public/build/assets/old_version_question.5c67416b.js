import{r as o}from"./vendor.c3066ab3.js";import{G as M,M as P}from"./App.fbfe1e5a.js";import{a as b,j as t,F as R}from"./index.e1943286.js";const j=({option:e,wasSelected:n,isCorrect:l,_id:p,isMarked:h,index:s,position:r,setAnswers:g,isMultiAnswersQuestion:_})=>t("div",{children:t("p",{children:b("label",{children:[t("input",{type:"checkbox",checked:n,className:"filled-in",disabled:h,onChange:m=>{g({option:e,isCorrect:l,_id:p})},required:!0,name:`sub_option_answer_${r}`}),t("span",{className:h&&l?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})})},s),O=({option:e,wasSelected:n,isCorrect:l,_id:p,isMarked:h,keyValue:s,position:r,setAnswers:g,isMultiAnswersQuestion:_})=>t("p",{children:b("label",{children:[t("input",{disabled:h,checked:n,required:!0,onChange:m=>{g({option:e,isCorrect:l,_id:p})},className:"with-gap",type:"radio",name:`sub_option_answer_${r}`}),t("span",{className:h&&l?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})},s),B=({children:e,index:n,isMarked:l,isCorrect:p})=>b("div",{style:{marginLeft:"15px",marginTop:"5px",marginBottom:"5px",display:"flex",flexDirection:"row"},children:[l?p?t("span",{style:{color:"green"},children:"\u2714"}):t("span",{style:{color:"red"},children:"\u2718"}):null,n+1,".",t("div",{children:e})]}),D=({children:e,index:n})=>t("div",{style:{marginLeft:"15px",marginTop:"5px",marginBottom:"5px"},children:e}),F=({question:e,index:n,AddInternalPaperContents:l,setAttempted:p,setCorrectAnswersCount:h,savedState:s,parentId:r})=>{const{attemptTree:g,currentPage:_,isMarked:m}=o.exports.useContext(M),[a,x]=o.exports.useState([]),[u,c]=o.exports.useState(!1),[C,A]=o.exports.useState(0);o.exports.useEffect(()=>{const i=g.pages[_].find(w=>w.content.question===r);if(!i)return;const f=i.content.children.find(w=>w.question===e._id);if(!f)return;const y=(e.options||[]).filter((w,L)=>f?f.attempted_options.findIndex(I=>I.optionID===w._id||I.optionIndex===L)>-1:!1);c(f.status),x([...a,...y])},[]),o.exports.useEffect(()=>{if(m&&a.length>0){const i=a.every(d=>d.isCorrect);c(i)}},[m,a]),o.exports.useEffect(()=>{C>0&&l({status:a.length?a.every(i=>i.isCorrect):!1,question:e._id,attempted_options:a.map(i=>({optionID:i._id,optionIndex:e.options.findIndex(d=>d._id===i._id)}))})},[C]);const v=o.exports.useMemo(()=>{var i,d;return((d=(i=e==null?void 0:e.options)==null?void 0:i.filter(f=>f.isCorrect))==null?void 0:d.length)>1},[e]),S=e.question.trim().replace(/(<([^>]+)>)/ig,"").trim().length<=1,$=i=>{if(a.length||p(1),v){const d=[...a],f=d.findIndex(y=>y._id===i._id);f>-1?d[f]=i:d.push(i),x(d)}else x([i]);A(d=>d+1)},k=S?B:D,T=(()=>{const i=v?j:O;return({position:d,index:f,option:y,isCorrect:w,_id:L,quesIndex:I,wasSelected:E})=>t(i,{_id:L,wasSelected:E,keyValue:`sub_option_${f}_${I}`,setAnswers:$,isMultiAnswersQuestion:S,position:d,option:y,index:f,isCorrect:w,isMarked:m},`sub_option_${f}_${I}`)})(),Q=i=>!!a.find(d=>d._id===i||0);return b("div",{style:{marginLeft:"6px"},children:[t("span",{dangerouslySetInnerHTML:{__html:S?"":`
                        <div style="display:flex;flex-direction:row;">
                            <p style="margin-right:5px;">
                                ${m?u?'<span style="color:green;">&#10004;</span>':'<span style="color:red;">&#10008;</span>':""}${n+1}.  
                            </p>
                            <p><strong>
                            ${e.question}
                            </strong></p>
                        </div>
                    `}}),t(k,{index:n,isMarked:m,isCorrect:u,children:e.options.map(({option:i,isCorrect:d,_id:f},y)=>T({_id:f,position:n,index:n,quesIndex:y,option:i,wasSelected:Q(f),isCorrect:d}))}),t("div",{style:{marginLeft:"15px",marginBottom:"10px"},hidden:!m,children:t("span",{dangerouslySetInnerHTML:{__html:`
                        <blockquote class="red lighten-5">
                            <span>
                                ${e.additionalInfo}
                            </span>
                        </blockquote>
                    `}})})]})},H=e=>{const n=5,l=e.length%n,p=Math.floor(e.length/n)+(l>0?1:0),h=new Array(p).fill([]);for(let s=0;s<p;s++)h[s]=e.slice(s*n,s*n+n);return h},V=(e,n,l=0)=>(p,h=!1)=>{const s=[];return p.forEach(r=>{const g=r.attempted_options[0].optionID,_=r.attempted_options[0].optionIndex,m=r.question;for(let a=0;a<n.length;a++){const x=n[a];if(x._id===m){const u=x.options.find((c,C)=>c._id===g||C===_);u&&s.push({position:a+1+l,option:u.option,isCorrect:u.isCorrect});break}}}),s.reduce((r,g)=>r.replace(new RegExp(`_{2,4}\\s?${g.position}\\s?_{2,4}`),`<span style="color:${h&&g.isCorrect?"green":"red"};"><u><b>${g.option}</b></u></span>`),e)},G=({parentId:e,position:n,sub_questions:l,setCorrectAnswersCount:p,setAttempted:h,savedChildren:s})=>{const{compSubQuestionPage:r,currentPage:g}=o.exports.useContext(M),_=o.exports.useCallback(u=>s.find(c=>c.question===u)||null,[l]),m=o.exports.useMemo(()=>H(l||[]),[l]),a=m[r],x=m.slice(0,r).reduce((u,c)=>u+c.length,0);return t(R,{children:a.map((u,c)=>t(F,{parentId:e,question:u,savedState:_(u._id),index:c+x+n,AddInternalPaperContents:C=>{},setAttempted:h,setCorrectAnswersCount:p},c))})},W=({question:e,isMarked:n,position:l,setAttempted:p,setCorrectAnswersCount:h})=>{const{compSubQuestionPage:s,currentPage:r,attemptTree:g}=o.exports.useContext(M);console.log(e._id);const[_,m]=o.exports.useState([]),[a,x]=o.exports.useState([]),[u,c]=o.exports.useState(e.question),[C,A]=o.exports.useState(-1),v=o.exports.useMemo(()=>e.children[0].question.trim().replace(/(<([^>]+)>)/ig,"").trim().length<=1,[e]),S=v?V(e.question,e.children,l):$=>e.question;return o.exports.useEffect(()=>{_.length>0&&v&&c(S(_,n))},[_]),o.exports.useEffect(()=>{const $=document.querySelectorAll(".question-comp img");P.Materialbox.init($);const k=g.pages[r].find(T=>T.content.question===e._id);if(!k)return;const N=k.content;m(N.children),x(N.children)},[]),o.exports.useEffect(()=>{A(Math.random()),console.log(`The current sub page is ${s}`)},[r]),b("div",{children:[t("span",{dangerouslySetInnerHTML:{__html:`<div class="question-comp">${u}</div>`}}),t("div",{style:{marginTop:"5px"},children:t(G,{parentId:e._id,position:l,savedChildren:a,setAttempted:p,setCorrectAnswersCount:h,sub_questions:e.children||[]},C)})]})},U=({question:e,position:n,setAttempted:l,setCorrectAnswersCount:p,AddLibraryPaperContents:h,isMarked:s=!1})=>{const[r,g]=o.exports.useState(""),[_,m]=o.exports.useState(!1),a=c=>{const C=c.target.value;l(!r&&C?1:C?0:-1),g(c.target.value)},x=o.exports.useCallback(()=>r.toLocaleLowerCase()===e.answer.toLowerCase(),[r,e,s]),u=o.exports.useMemo(()=>e.subject.split(" ")[0].toLowerCase()==="kiswahili",[e]);return o.exports.useEffect(()=>{const c=x();m(c),p(c?1:0),h({questionType:"oldversion",content:{status:c,question:e._id,attempted_option:r}})},[s]),b("div",{className:"col s12",style:{marginBottom:"7px"},children:[b("div",{style:{display:"flex",flexDirection:"row"},children:[s?_?t("span",{style:{color:"green"},children:"\u2714"}):t("span",{style:{color:"red"},children:"\u2718"}):null,b("span",{style:{marginRight:"5px"},children:[n+1,". "]}),t("p",{children:b("span",{className:"left-align",children:[e.question,b("span",{className:"left-align",children:[t("br",{}),t("b",{children:e.options})]})]})})]}),b("div",{style:{marginLeft:"15px"},children:[b("div",{className:"input-field col s12",children:[t("input",{title:"Enter A B C or D",onChange:a,disabled:s,value:r,id:`trial_answer${n}`,required:!0,type:"text",className:"validate",style:{color:s?x()?"green":"red":"black"}}),t("label",{htmlFor:`trial_answer${n}`,children:u?"Jibu":"Answer"})]}),t("div",{hidden:!s,className:"col s12",children:t("blockquote",{className:"green lighten-5",style:{borderLeftColor:"#00e676"},children:b("p",{id:`correct_answer_display${n}`,className:"bold",children:[u?"Jibu Sahihi: ":"Correct Answer: ",e.answer]})})}),t("div",{hidden:!s,className:"col s12",children:t("blockquote",{className:"red lighten-5",children:t("p",{id:`additional_information${n}`,className:"bold",children:e.additionalInfo})})})]})]})};export{W as C,U as O,H as g};
