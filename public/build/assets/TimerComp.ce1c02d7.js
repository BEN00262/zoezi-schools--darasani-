import{a as o,R as E}from"./vendor.0b632b43.js";import{n as R,M as O}from"./App.77f6c601.js";import{a as w,j as t,F as Q}from"./index.094b12c6.js";import{c as D}from"./millisecondsToTime.6095074a.js";const F=({option:e,_id:s,isCorrect:n,isMarked:c,index:u,position:i,setSuggestedAnswer:d,wasSelected:m})=>t("div",{children:t("p",{children:w("label",{children:[t("input",{type:"checkbox",className:"filled-in",disabled:c,checked:m||!1,onChange:y=>{d({option:e,isCorrect:n,_id:s})},name:`options_${i}`}),t("span",{className:c&&n?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})})},u),H=({option:e,_id:s,isCorrect:n,isMarked:c,index:u,position:i,setSuggestedAnswer:d,wasSelected:m})=>t("div",{children:t("p",{children:w("label",{children:[t("input",{disabled:c,onChange:y=>{d({option:e,isCorrect:n,_id:s})},required:!0,checked:m||!1,className:"with-gap",name:`options_${i}`,type:"radio"}),t("span",{className:c&&n?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})})},u),q=({question:e,position:s,isMarked:n,setAttempted:c,setCorrectAnswersCount:u,savedQuestion:i,AddPageStudentPaperContent:d})=>{const{currentPage:m,attemptTree:y}=o.exports.useContext(R),[l,a]=o.exports.useState([]),[v,x]=o.exports.useState(!1),f=o.exports.useMemo(()=>{var h,_;return((_=(h=e==null?void 0:e.options_next)==null?void 0:h.filter(g=>g.isCorrect))==null?void 0:_.length)||0},[e]),I=f>1||!1,$=h=>!!l.find(_=>_._id===h);o.exports.useEffect(()=>{let h=document.querySelectorAll(".question-comp img");O.Materialbox.init(h);let _=y.pages[m].find(r=>r.content.question===e._id);if(!_)return;let g=_.content,b=(e.options_next||[]).filter((r,p)=>g.attempted_options.findIndex(C=>C.optionID===r._id||C.optionIndex===p)>-1);x(b.length>0?b.every(r=>r.isCorrect):!1),a([...l,...b])},[]),o.exports.useEffect(()=>{l.length>0&&d(e._id,{questionType:"normal",content:{status:l.length>0?l.every(h=>h.isCorrect):!1,question:e._id,attempted_options:l.map(h=>({optionID:h._id,optionIndex:(e.options_next||[]).findIndex(_=>_._id===h._id)}))}})},[l]),o.exports.useEffect(()=>{if(n&&f===l.length){let h=l.length>0?l.every(_=>_.isCorrect):!1;x(h),u(h?1:0)}},[n]);const A=h=>{if(l.length||c(1),I){const _=l.findIndex(g=>g.option===h.option);if(_>-1){let g=[...l];g.splice(_),a(g),g.length||c(-1);return}a([...l,h]);return}a([h])},N=(()=>{let h=I?F:H;return({position:_,index:g,_id:b,option:r,isCorrect:p,wasSelected:C})=>t(h,{_id:b,setSuggestedAnswer:A,position:_,option:r,index:g,isCorrect:p,isMarked:n,wasSelected:C},g)})();return w("div",{children:[t("span",{dangerouslySetInnerHTML:{__html:`
                    <div style="display:flex;flex-direction:row;">
                        ${n?v?'<span style="color:green;">&#10004;</span>':'<span style="color:red;">&#10008;</span>':""} 
                        <p style="margin-right:5px;">${s+1}.  </p><strong class="question-comp">${e.question}</strong>
                    </div>
                `}}),t("div",{style:{marginTop:"10px",marginLeft:"17px",marginBottom:"10px"},children:e.options_next&&e.options_next.map(({option:h,isCorrect:_,_id:g},b)=>N({position:s,_id:g,option:h,index:b,isCorrect:_,wasSelected:$(g)}))}),t("div",{style:{marginLeft:"17px",marginBottom:"10px"},hidden:!n,children:t("span",{dangerouslySetInnerHTML:{__html:`
                        <blockquote class="red lighten-5">
                            <span>
                            ${e.additionalInfo}
                            </span>
                        </blockquote>
                    `}})})]})},j=({option:e,wasSelected:s,isCorrect:n,_id:c,isMarked:u,index:i,position:d,setAnswers:m,isMultiAnswersQuestion:y})=>t("div",{children:t("p",{children:w("label",{children:[t("input",{type:"checkbox",checked:s,className:"filled-in",disabled:u,onChange:l=>{m({option:e,isCorrect:n,_id:c})},required:!0,name:`sub_option_answer_${d}`}),t("span",{className:u&&n?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})})},i),P=({option:e,wasSelected:s,isCorrect:n,_id:c,isMarked:u,keyValue:i,position:d,setAnswers:m,isMultiAnswersQuestion:y})=>t("p",{children:w("label",{children:[t("input",{disabled:u,checked:s,required:!0,onChange:l=>{m({option:e,isCorrect:n,_id:c})},className:"with-gap",type:"radio",name:`sub_option_answer_${d}`}),t("span",{className:u&&n?"green-text":"black-text",children:t("b",{children:t("span",{dangerouslySetInnerHTML:{__html:e}})})})]})},i),V=({children:e,index:s,isMarked:n,isCorrect:c})=>w("div",{style:{marginLeft:"15px",marginTop:"5px",marginBottom:"5px",display:"flex",flexDirection:"row"},children:[n?c?t("span",{style:{color:"green"},children:"\u2714"}):t("span",{style:{color:"red"},children:"\u2718"}):null,s+1,".",t("div",{children:e})]}),z=({children:e,index:s})=>t("div",{style:{marginLeft:"15px",marginTop:"5px",marginBottom:"5px"},children:e}),J=({question:e,index:s,AddInternalPaperContents:n,setAttempted:c,setCorrectAnswersCount:u,savedState:i,parentId:d})=>{const{attemptTree:m,currentPage:y,isMarked:l}=o.exports.useContext(R),[a,v]=o.exports.useState([]),[x,f]=o.exports.useState(!1),[I,$]=o.exports.useState(0);o.exports.useEffect(()=>{let r=m.pages[y].find(T=>T.content.question===d);if(!r)return;let C=r.content.children.find(T=>T.question===e._id);if(!C)return;let S=(e.options||[]).filter((T,M)=>C?C.attempted_options.findIndex(L=>L.optionID===T._id||L.optionIndex===M)>-1:!1);f(C.status),v([...a,...S])},[]),o.exports.useEffect(()=>{if(l&&a.length>0){let r=a.every(p=>p.isCorrect);f(r)}},[l,a]),o.exports.useEffect(()=>{I>0&&n({status:a.length?a.every(r=>r.isCorrect):!1,question:e._id,attempted_options:a.map(r=>({optionID:r._id,optionIndex:e.options.findIndex(p=>p._id===r._id)}))})},[I]);const A=o.exports.useMemo(()=>{var r,p;return((p=(r=e==null?void 0:e.options)==null?void 0:r.filter(C=>C.isCorrect))==null?void 0:p.length)>1},[e]),k=e.question.trim().replace(/(<([^>]+)>)/ig,"").trim().length<=1,N=r=>{if(a.length||c(1),A){let p=[...a],C=p.findIndex(S=>S._id===r._id);C>-1?p[C]=r:p.push(r),v(p)}else v([r]);$(p=>p+1)},h=k?V:z,g=(()=>{let r=A?j:P;return({position:p,index:C,option:S,isCorrect:T,_id:M,quesIndex:L,wasSelected:B})=>t(r,{_id:M,wasSelected:B,keyValue:`sub_option_${C}_${L}`,setAnswers:N,isMultiAnswersQuestion:k,position:p,option:S,index:C,isCorrect:T,isMarked:l},`sub_option_${C}_${L}`)})(),b=r=>!!a.find(p=>p._id===r||0);return w("div",{style:{marginLeft:"6px"},children:[t("span",{dangerouslySetInnerHTML:{__html:k?"":`
                        <div style="display:flex;flex-direction:row;">
                            <p style="margin-right:5px;">
                                ${l?x?'<span style="color:green;">&#10004;</span>':'<span style="color:red;">&#10008;</span>':""}${s+1}.  
                            </p>
                            <p><strong>
                            ${e.question}
                            </strong></p>
                        </div>
                    `}}),t(h,{index:s,isMarked:l,isCorrect:x,children:e.options.map(({option:r,isCorrect:p,_id:C},S)=>g({_id:C,position:s,index:s,quesIndex:S,option:r,wasSelected:b(C),isCorrect:p}))}),t("div",{style:{marginLeft:"15px",marginBottom:"10px"},hidden:!l,children:t("span",{dangerouslySetInnerHTML:{__html:`
                        <blockquote class="red lighten-5">
                            <span>
                                ${e.additionalInfo}
                            </span>
                        </blockquote>
                    `}})})]})},U=e=>{let s=5,n=e.length%s,c=Math.floor(e.length/s)+(n>0?1:0),u=new Array(c).fill([]);for(let i=0;i<c;i++)u[i]=e.slice(i*s,i*s+s);return u},W=(e,s,n=0)=>(c,u=!1)=>{let i=[];return c.forEach(d=>{let m=d.attempted_options[0].optionID,y=d.attempted_options[0].optionIndex,l=d.question;for(let a=0;a<s.length;a++){let v=s[a];if(v._id===l){let x=v.options.find((f,I)=>f._id===m||I===y);x&&i.push({position:a+1+n,option:x.option,isCorrect:x.isCorrect});break}}}),i.reduce((d,m)=>d.replace(new RegExp(`_{2,4}\\s?${m.position}\\s?_{2,4}`),`<span style="color:${u&&m.isCorrect?"green":"red"};"><u><b>${m.option}</b></u></span>`),e)},G=E.memo(({parentId:e,position:s,sub_questions:n,AddInternalPaperContents:c,setCorrectAnswersCount:u,setAttempted:i,compSubQuestionPage:d,savedChildren:m})=>{const y=o.exports.useCallback(x=>m.find(f=>f.question===x)||null,[n]);let l=o.exports.useMemo(()=>U(n||[]),[n]),a=l[d],v=l.slice(0,d).reduce((x,f)=>x+f.length,0);return t(Q,{children:a.map((x,f)=>t(J,{parentId:e,question:x,savedState:y(x._id),index:f+v+s,AddInternalPaperContents:c,setAttempted:i,setCorrectAnswersCount:u},f))})}),ee=({question:e,isMarked:s,position:n,setAttempted:c,setCorrectAnswersCount:u,AddPageStudentPaperContent:i,savedQuestion:d})=>{const{compSubQuestionPage:m,currentPage:y,attemptTree:l}=o.exports.useContext(R),[a,v]=o.exports.useState([]),[x,f]=o.exports.useState([]),[I,$]=o.exports.useState(e.question),[A,k]=o.exports.useState(-1),N=o.exports.useMemo(()=>e.children[0].question.trim().replace(/(<([^>]+)>)/ig,"").trim().length<=1,[e]),h=N?W(e.question,e.children,n):g=>e.question,_=g=>{let b=[...a],r=b.findIndex(p=>p.question===g.question);r>-1?b[r]=g:b=[...b,g],v(b)};return o.exports.useEffect(()=>{a.length>0&&(i(e._id,{questionType:"comprehension",content:{question:e._id,children:a}}),N&&$(h(a,s)))},[a]),o.exports.useEffect(()=>{let g=document.querySelectorAll(".question-comp img");O.Materialbox.init(g);let b=l.pages[y].find(p=>p.content.question===e._id);if(!b)return;let r=b.content;v(r.children),f(r.children)},[]),o.exports.useEffect(()=>{k(Math.random())},[m]),w("div",{children:[t("span",{dangerouslySetInnerHTML:{__html:`<div class="question-comp">${I}</div>`}}),t("div",{style:{marginTop:"5px"},children:t(G,{AddInternalPaperContents:_,parentId:e._id,position:n,savedChildren:x,compSubQuestionPage:m,setAttempted:c,setCorrectAnswersCount:u,sub_questions:e.children||[]},A)})]})},te=({question:e,position:s,setAttempted:n,setCorrectAnswersCount:c,AddLibraryPaperContents:u,isMarked:i=!1})=>{const[d,m]=o.exports.useState(""),[y,l]=o.exports.useState(!1),a=f=>{const I=f.target.value;n(!d&&I?1:I?0:-1),m(f.target.value)},v=o.exports.useCallback(()=>d.toLocaleLowerCase()===e.answer.toLowerCase(),[d,e,i]),x=o.exports.useMemo(()=>e.subject.split(" ")[0].toLowerCase()==="kiswahili",[e]);return o.exports.useEffect(()=>{let f=v();l(f),c(f?1:0),u({questionType:"oldversion",content:{status:f,question:e._id,attempted_option:d}})},[i]),w("div",{className:"col s12",style:{marginBottom:"7px"},children:[w("div",{style:{display:"flex",flexDirection:"row"},children:[i?y?t("span",{style:{color:"green"},children:"\u2714"}):t("span",{style:{color:"red"},children:"\u2718"}):null,w("span",{style:{marginRight:"5px"},children:[s+1,". "]}),t("p",{children:w("span",{className:"left-align",children:[e.question,w("span",{className:"left-align",children:[t("br",{}),t("b",{children:e.options})]})]})})]}),w("div",{style:{marginLeft:"15px"},children:[w("div",{className:"input-field col s12",children:[t("input",{title:"Enter A B C or D",onChange:a,disabled:i,value:d,id:`trial_answer${s}`,required:!0,type:"text",className:"validate",style:{color:i?v()?"green":"red":"black"}}),t("label",{htmlFor:`trial_answer${s}`,children:x?"Jibu":"Answer"})]}),t("div",{hidden:!i,className:"col s12",children:t("blockquote",{className:"green lighten-5",style:{borderLeftColor:"#00e676"},children:w("p",{id:`correct_answer_display${s}`,className:"bold",children:[x?"Jibu Sahihi: ":"Correct Answer: ",e.answer]})})}),t("div",{hidden:!i,className:"col s12",children:t("blockquote",{className:"red lighten-5",children:t("p",{id:`additional_information${s}`,className:"bold",children:e.additionalInfo})})})]})]})},ne=E.memo(({onTimeUp:e})=>{const{isMarked:s}=o.exports.useContext(R),[n,c]=o.exports.useState(+`${localStorage.getItem("remainingTime")}`||0),[u,i]=o.exports.useState(!1),d=o.exports.useMemo(()=>D(n<0?0:n),[n]);return o.exports.useEffect(()=>{if(n<=0){i(!0),s||e();return}localStorage.setItem("remainingTime",`${n>=0?n:0}`)},[n]),o.exports.useEffect(()=>{if(!u||!s){let m=setInterval(()=>{c(y=>y-1e3)},1e3);return()=>{clearInterval(m)}}},[u]),t(Q,{children:t("button",{className:"waves-effect waves-light btn-small z-depth-0 white black-text",children:d})})});export{ee as C,q as N,te as O,ne as T};
